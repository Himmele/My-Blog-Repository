<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0038)http://www.embedded.com/98/9804fe4.htm -->
<HTML><HEAD><TITLE>Embedded x86 Programming: Protected Mode</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<META 
content="embedded systems,conference,development,real-time,programming,emulators,multitasking,debugging,software,optimization,engineer,RTOS,chips,tools,microcontrollers,DSP,operating systems,kernel,microprocessors,object-oriented,single board,ada,C++,visual basic,forth,RISC,compilers,specialty libraries, configuration management,ICE,ROM emulators,logic analyzers,device programmers,oscilloscopes,8-bit,eprom,flash,OEM,boards,Miller Freeman,vendor,magazine,custom publishing,esp,esc,directories,mwmedia,Windows CE, Win CE, CE, Windows, Microsoft, developer,  software, operating system, hand held, wallet, PC, OS, mobile, wireless, portable, driver, ETK, OAL, OAK, Pentium, 486, MIPS, Smartcards, Cellular Phone, Small-Form-Factor, H/PC, Palm, CE, RFA, PDA, PIC" 
name=keywords>
<META 
content="Welcome to Embedded.com, the on-line resource for embedded systems developers. This is the place to come for tutorials, code,  demos, and news, along with information about Embedded Systems Programming Magazine and the Embedded Systems Conferences. " 
name=description>
<META content="Embedded x86 Programming: Protected Mode" name=Headline>
<META content="April 1998" name=issue>
<META content="Jean Gareau" name=author>
<SCRIPT language=javascript1.2 type=text/javascript>
/*
Dr. Clue's drop-down menu system for 4th generation browsers
        copyright @ 1998,1999 drclue , www.drclue.net
license is granted for use of this software by individuals
in support of personal web-sites. All other rights reserved.
*/
//*** Global Variables
var LIBLOADEDJSmenu=false;
var     systemLibCnt    =0;
var     systemIsNS      =(document.layers!=null);       // Is it a Netscape browser
var     systemMouseDn   =false; // mousemove dragging
if(document.layers)document.all=document.layers;
var     systemMaxZ      =0; 
var     systemNullChk   =((systemIsNS)?((navigator.appVersion.substring(0,4)=="4.05")?"null":"undefined"):"null")
var menuTimeOut         =null;  // mouseout Cancel menu timer
var     menuCurrentItem =null;  // currently highlighted object.
var     menuCurrentPath ="";    // The open menu list.
var     menuScreenWidth =0;
//*** General Menu  configuration variables
var     menuSubAuto     =false;
var     menuSubSymbol   ="&raquo;";     // html to indicate sub menu
var     menuRoll        =true;  // Show menu items as built
var     menuCharHeight  =11;    // Avg Char Height.
var     menuCharWidth   =5;     // Avg Char Width.
var     menuYpopoff     =0;
var     menuXpopoff     =178;
var     menuBcolor      ="#ABABAB";     // background
var     menuTcolor      ="#FFFFFF";     // Text
var     menuHBcolor     ="#FFFFFF";
var     menuHTcolor     ="#ABABAB";
var     menuFont        ="verdana,arial";// menu label font
var     menuFontSize    =1;     // menu font size
var     menuBold        =false; // Use bold
var     menuAtimeout    =4500;
var     Firstpass       =true;
var     lastEVENT       =null;

var szDuds="Mozilla/4.0 (compatible; MSIE 4.5; Mac_PowerPC)";

esconfoff = new Image;
esconfoff.src = "http://img.cmpnet.com/embedded/redesign/es_conf.gif";
esconfon = new Image;
esconfon.src = "http://img.cmpnet.com/embedded/redesign/es_conf_on.gif";

magoff = new Image;
magoff.src = "http://img.cmpnet.com/embedded/redesign/esp_mag.gif";
magon = new Image;
magon.src = "http://img.cmpnet.com/embedded/redesign/esp_mag_on.gif";

iaoff = new Image;
iaoff.src = "http://img.cmpnet.com/embedded/redesign/ia.gif";
iaon = new Image;
iaon.src = "http://img.cmpnet.com/embedded/redesign/ia_on.gif";

downoff = new Image;
downoff.src = "http://img.cmpnet.com/embedded/redesign/code.gif";
downon = new Image;
downon.src = "http://img.cmpnet.com/embedded/redesign/code_on.gif";

demooff = new Image;
demooff.src = "http://img.cmpnet.com/embedded/redesign/prod_demos.gif";
demoon = new Image;
demoon.src = "http://img.cmpnet.com/embedded/redesign/prod_demos_on.gif";

resoff = new Image;
resoff.src = "http://img.cmpnet.com/embedded/redesign/resources.gif";
reson = new Image;
reson.src = "http://img.cmpnet.com/embedded/redesign/resources_on.gif";

ieoff = new Image;
ieoff.src = "http://img.cmpnet.com/embedded/redesign/ind_ev.gif";
ieon = new Image;
ieon.src = "http://img.cmpnet.com/embedded/redesign/ind_ev_on.gif";

guideoff = new Image;
guideoff.src = "http://img.cmpnet.com/embedded/redesign/buyers.gif";
guideon = new Image;
guideon.src = "http://img.cmpnet.com/embedded/redesign/buyers_on.gif";

siteoff = new Image;
siteoff.src = "http://img.cmpnet.com/embedded/redesign/sitemap.gif";
siteon = new Image;
siteon.src = "http://img.cmpnet.com/embedded/redesign/sitemap_on.gif";

productsoff = new Image;
productsoff.src = "http://img.cmpnet.com/embedded/redesign/new_prod.gif";
productson = new Image;
productson.src = "http://img.cmpnet.com/embedded/redesign/new_prod_on.gif";

directoff = new Image;
directoff.src = "http://img.cmpnet.com/embedded/redesign/catalogs.gif";
directon = new Image;
directon.src = "http://img.cmpnet.com/embedded/redesign/catalogs_on.gif";

cdromoff = new Image;
cdromoff.src = "http://img.cmpnet.com/embedded/redesign/cdrom.gif";
cdromon = new Image;
cdromon.src = "http://img.cmpnet.com/embedded/redesign/cdrom_on.gif";

embeddedbooksoff = new Image;
embeddedbooksoff.src = "http://img.cmpnet.com/embedded/redesign/embeddedbooks.gif";
embeddedbookson = new Image;
embeddedbookson.src = "http://img.cmpnet.com/embedded/redesign/embeddedbooks_on.gif";

researchoff = new Image;
researchoff.src = "http://img.cmpnet.com/embedded/redesign/market.gif";
researchon = new Image;
researchon.src = "http://img.cmpnet.com/embedded/redesign/market_on.gif";

jobsoff = new Image;
jobsoff.src = "http://img.cmpnet.com/embedded/redesign/job.gif";
jobson = new Image;
jobson.src = "http://img.cmpnet.com/embedded/redesign/job_on.gif";


welcomeoff = new Image;
welcomeoff.src = "http://img.cmpnet.com/embedded/redesign/welcometo.gif";
welcomeon = new Image;
welcomeon.src = "http://img.cmpnet.com/embedded/redesign/welcometo_on.gif";

function imgSwap(imgId,imgSrc,restat) {
   document.images[imgId].src=eval(imgSrc+'.src');
   if (restat)window.status='';
}

function PreLoads(treeList)
        {
        window.status="["+systemLibCnt+"] menu.js["+LIBLOADEDJSmenu + "] items ["+""+" Loading ...";
        if(!LIBLOADEDJSmenu)
          {  setTimeout("PreLoads('"+treeList+"')",500);return;   }
        window.onResize="document.location.href=document.location.href";        
        if(!document.links.length)
          {  setTimeout("PreLoads('"+treeList+"')",500);return;   }
        window.status="initializing";
        while(treeList.length>1)
             {          
             killboy =treeList.substring(1);
             killboy =killboy.substring(0,killboy.indexOf(":"));
             treeList=treeList.substring(killboy.length+1);
             window.status="Loading "+killboy;
             menuCREATE(killboy,0,0);
             }
        window.status="";
        }


/* Called by the jsLAYERclass to create
a layer if the layer does not already exist.*/
function jsLAYERcreateLayer(Homeboy,x,y,w,h,bColor)
        {
        if(systemIsNS)
          {
          var lyr= document.layers[Homeboy.lyrName] = new Layer(w)
          lyr.left=x;lyr.top=y; lyr.clip.height=h+1;lyr.clip.width=w+1;
          lyr.bgColor=((jsLAYERcreateLayer.arguments.length>5)?bColor:menuBcolor);
          lyr.visibility='hidden';lyr.zIndex=1;
          lyr.isHighlight=false;
          lyr.border=1;
          document.layers[Homeboy.lyrName].style=document.layers[Homeboy.lyrName];
          }else{
          var str = '\n<DIV id='+Homeboy.lyrName+' style="visibility: hidden; position:absolute; left:'+x+'; top:'+y+'; width:'+w
          str += '; height:'+(h+1)+'px; clip:rect(0px '+(w+1)+'px '+(h+1)+'px 0px)'
          str += '; background-color:'+((jsLAYERcreateLayer.arguments.length>5)?bColor:menuBcolor)+';z-Index:5;"> </DIV>';
          document.body.insertAdjacentHTML("BeforeEnd",str);
          }
        Homeboy.jsLAYERobject=document.all[Homeboy.lyrName];
        if(systemIsNS)
          {
          Homeboy.jsLAYERdocument  =document.layers[Homeboy.lyrName].document;
          Homeboy.style            =document.layers[Homeboy.lyrName];
          }else{
          Homeboy.jsLAYERdocument  =document.all[Homeboy.lyrName];
          Homeboy.style            =document.all[Homeboy.lyrName].style;
          Homeboy.style.zIndex     =systemMaxZ++;
          }
        Homeboy.jsLAYERobject.HomeBoy=Homeboy;
        Homeboy.jsLAYERobject.W =w;
        Homeboy.jsLAYERobject.X =x;
        Homeboy.jsLAYERobject.Y =y;
        Homeboy.jsLAYERobject.H =h;
        Homeboy.jsLAYERobject.MOUSEHANDLER="MOUSEVECTOR";
        return Homeboy;
        }
function jsLAYERsetHandler(Homeboy,szHANDLER) // named function for events
        {
        Homeboy.jsLAYERobject.MOUSEHANDLER=szHANDLER;
        MOUSECAPTURE(Homeboy,Homeboy.lyrName);
        }
function jsLAYERhomeboy(layername){return document.all[layername].HomeBoy;}
function jsLAYERopen(Homeboy){if(systemIsNS){Homeboy.jsLAYERobject.document.open();  }else{  Homeboy.jsLAYERobject.innerHTML="";}}
function jsLAYERwrite(Homeboy,Text){if(systemIsNS){Homeboy.jsLAYERdocument.write(Text);}else{Homeboy.jsLAYERobject.innerHTML+=Text;}}
function jsLAYERclose(Homeboy)
        {
        if(systemIsNS)
          {
          Homeboy.jsLAYERdocument.close();
          MOUSECAPTURE(Homeboy,Homeboy.lyrName);
          }
        }
function jsLAYERsetContent(Homeboy,text)
        {
        jsLAYERopen(Homeboy);
        jsLAYERwrite(Homeboy,text);
        jsLAYERclose(Homeboy);return;
        }
function jsLAYERshow(Homeboy,vis){Homeboy.style.visibility=((vis)?"visible":"hidden");}
function jsLAYERgetX(Homeboy){return parseInt(Homeboy.style.left);}
function jsLAYERgetY(Homeboy){return parseInt(Homeboy.style.top);}
function jsLAYERxy(Homeboy,x,y,InLayer)
        {
        this.InX=x;this.InY=y;
        if(document.layers)
          {
          if(InLayer)
            {
            InX+=InLayer.style.left;
            InY+=InLayer.style.top;
            }
          Homeboy.jsLAYERobject.x=this.InX;
          Homeboy.jsLAYERobject.y=this.InY;
          }else{
          if(InLayer)
            {
            this.InX+=parseInt(document.all[Homeboy.lyrName].style.left);
            this.InY+=parseInt(document.all[Homeboy.lyrName].style.top);
            }
//alert(document.all[Homeboy.lyrName].style.left+"[]"+this.InX+"[]"+x)
          document.all[Homeboy.lyrName].style.left=this.InX
          document.all[Homeboy.lyrName].style.top=this.InY

          }


        }
/*Function      :MEVENT
**Parameters    :Homeboy        - Layer Class Pointer
**               Evt            - javascript Browser Event
**Description   :Noramalizes Netscape/MSIE evnts to 
**a class containing variables for both, with Netscape names
**superceding MSIE names. It is this psudeo event class that
**is passed to all MOUSE... event handler functions.
*/
function MEVENT(Homeboy,Evt) //normalizes the differences in NS and MSIE events
        {
        this.type=Evt.type;
        this.screenX=Evt.screenX;
        this.screenY=Evt.screenY;
        if(systemIsNS)
          {
        this.pageX=Evt.pageX;
        this.pageY=Evt.pageY;
        this.locationX=Homeboy.jsLAYERobject.x;
        this.locationY=Homeboy.jsLAYERobject.y;
        this.layerX=Evt.layerX;
        this.layerY=Evt.layerY;
        this.which=Evt.which;
        this.target=Evt.target;
        this.modifiers=Evt.modifiers;
          }else{
        this.pageX=Evt.x;
        this.pageY=Evt.y;
        if(document.body.scrollTop)this.pageY+=document.body.scrollTop;
        this.locationX=parseInt(Homeboy.jsLAYERobject.style.left);
        this.locationY=parseInt(Homeboy.jsLAYERobject.style.top);
        this.layerX=this.pageX-this.locationX;
        this.layerY=this.pageY-this.locationY;
        this.which=Evt.button+1;
        this.target=Evt.srcElement;
        this.modifiers=(((Evt.altKey)?1:0)+((Evt.ctrlKey)?2:0)+((Evt.AltKey)?4:0));
          }
        }
function MOUSEVECTOR(layername,Evt)// handles the actuall prep and call of mouse events
        {
        Homeboy=document.all[layername].HomeBoy;return false;
        }
// Sets up mouse event NOTE: Use of "new Function" is important
function MOUSECAPTURE(Homeboy,layername)
        {

var NFD="return "+Homeboy.jsLAYERobject.MOUSEHANDLER+"('"+layername+"',"+((systemIsNS)?"arguments[0]":"window.event")+")"
Homeboy.jsLAYERobject.onmouseover=new Function(NFD)
Homeboy.jsLAYERobject.onmouseout=new Function(NFD)
Homeboy.jsLAYERdocument.onmousemove=new Function(NFD)
Homeboy.jsLAYERdocument.onmousedown=new Function(NFD)
Homeboy.jsLAYERdocument.onmouseup=new Function(NFD)
if(systemIsNS)Homeboy.jsLAYERdocument.captureEvents(  Event.MOUSEUP |   Event.MOUSEDOWN   | Event.MOUSEMOVE);
        }
function NSResizePatch(){document.location.href=document.location.href;}
function jsNULLvector(layername,Evt){return true;}
var MPTYPE ="",MSTYPE ="";
function jsMPANELvector(panelName,Evt)  // Vectors mouse messages for the panel
        {
        Homeboy=jsLAYERhomeboy(panelName);
        if(menuTimeOut)clearTimeout(menuTimeOut);
        if(Evt.type=="mouseout" || Evt.type=="mouseover") 
          {
          MPTYPE=Evt.type;
          if(MPTYPE==MSTYPE&&MPTYPE=="mouseout")menuTimeOut=setTimeout("menuPOPDN()",100);
          }
        if(Evt.type!="mousemove" )return false;
        EVENT=new MEVENT(Homeboy,Evt);

        EntryNum=0;
        EntryNotch=EVENT.layerY;
        if(EntryNotch)
          {
          EntryNotch-=(EntryNotch%(menuCharHeight+1));
          EntryNum=(EntryNotch/(menuCharHeight+1))
          }
        if(Homeboy.mParent.Items.length<=EntryNum)return true;
        lastEVENT=EVENT;
        if(Homeboy.mParent.EntryNum==EntryNum)return false;

//if(!systemIsNS)
//{
//alert(EntryNum+"[]"+EntryNotch+"[]"+EVENT.layerY)
//Homeboy.mParent.Items[EntryNum].RENDER)
//}
        jsLAYERsetContent(Homeboy.mParent.mSELECT,Homeboy.mParent.Items[EntryNum].RENDER);

        jsLAYERxy(Homeboy.mParent.mSELECT,jsLAYERgetX(Homeboy),jsLAYERgetY(Homeboy)+(EntryNum*(menuCharHeight+1)));
        Homeboy.mParent.EntryNum=EntryNum;
        if(!menuSubAuto)return false;
        if(Homeboy.mParent.Items[EntryNum].ACTION.substring(0,1)=="@")
          {
          fakeEvt = new Object();
          fakeEvt.type="mouseup";
          jsMSELECTvector(Homeboy.mParent.mSELECT.lyrName,fakeEvt);
          }
        return false;
        }
/*
** Vectors mouse messages for the menu selector
*/
function jsMSELECTvector(panelName,Evt)
        {
        if(menuTimeOut)clearTimeout(menuTimeOut);
        if(Evt.type=="mouseout" || Evt.type=="mouseover") 
          {
          MSTYPE=Evt.type;
          if(MPTYPE==MSTYPE&&MPTYPE=="mouseout")menuTimeOut=setTimeout("menuPOPDN()",100);
          Homeboy=jsLAYERhomeboy(panelName);
          return false;
          }
        if(Evt.type!="mouseup")return false;
        Homeboy=jsLAYERhomeboy(panelName);
        var action = Homeboy.mParent.Items[Homeboy.mParent.EntryNum].ACTION;

        if(menuCurrentPath.indexOf(Homeboy.jsLAYERobject.GROUP)>0)
          {
          var FindGroup = ":"+Homeboy.jsLAYERobject.GROUP+":";
          var killList = menuCurrentPath.substring(menuCurrentPath.indexOf(FindGroup)+FindGroup.length-1);
          menuPOPDN(killList);
          }
        if(action.length<1){window.status="[Not Available]";return false;}
        var isMenu = action.substring(0,1)=="@";
        var isJavascript = action.substring(0,1)=="!";
        if(isJavascript)
          {
          eval(action.substring(1))
          return false;
          }
        if(isMenu)
          {
          menuPOPUP(jsLAYERgetX(Homeboy)+Homeboy.jsLAYERobject.W+2,jsLAYERgetY(Homeboy),action.substring(1));
          }else{
          document.location.href=action;
          }
        return false;
        }
/*
** This is the menu panel
*/
function jsMPANELclass(group,entry,label,action,x,y,w,h)
        {
        this.lyrName            =group+entry;
        if(!document.all[this.lyrName])jsLAYERcreateLayer(this,x,y,w,h,"#000000");
        jsLAYERsetHandler(this,"jsMPANELvector");
        this.jsLAYERobject.GROUP=group;this.jsLAYERobject.ENTRY=entry;
        this.jsLAYERobject.rtWidth=10;
        this.jsLAYERobject.rtSymbol="&raquo;";
        }
/*
** This is the highlite bar
*/
function jsMSELECTclass(group,entry,label,action,x,y,w,h)
        {
        this.lyrName            =group+entry;
        if(!document.all[this.lyrName])jsLAYERcreateLayer(this,x,y,w,h);
        jsLAYERsetHandler(this,"jsMSELECTvector");
        this.jsLAYERobject.GROUP=group;
        this.jsLAYERobject.ENTRY=entry;
        this.jsLAYERobject.rtWidth=10;
        this.jsLAYERobject.rtSymbol="&raquo;";
        }
/*
** Create the menu label obeject string for display
*/
function menuLABEL(Homeboy,text,isHighlight,isSub)
        {
        var fontstart="<FONT FACE='"+menuFont+"' SIZE="+menuFontSize+" COLOR='"+((isHighlight)?menuHTcolor:menuTcolor)+"'>"+((menuBold)?"<B>":"");
        var CONTENT="&nbsp;";
        if(text)CONTENT=text.length?"&nbsp;"+text:"&nbsp;";
        var lyrtxt="<TABLE BORDER=0 CELLPADDING=0 STYLE='cursor:hand' CELLSPACING='0' BGCOLOR='";
        lyrtxt+=((isHighlight)?menuHBcolor:menuBcolor);
        lyrtxt+="' WIDTH='"+Homeboy.jsLAYERobject.W+"' HEIGHT='"+menuCharHeight+"'><TR VALIGN=MIDDLE>";
        twidth=parseInt(Homeboy.jsLAYERobject.W)-parseInt(Homeboy.jsLAYERobject.rtWidth);
        lyrtxt+="<TD WIDTH='"+twidth.toString();
        lyrtxt+="'>"+fontstart+CONTENT+((menuBold)?"</B>":"")+"</FONT></TD>";
        lyrtxt+="<TD WIDTH='10'>"+fontstart+((isSub)?menuSubSymbol:"&nbsp;")+((menuBold)?"</B>":"")+"</FONT></TD></TR></TABLE>";
        return lyrtxt;
        }
function MenuItem(label,action)
        {
        this.LABEL      =label  ;
        this.ACTION     =action ;
        this.SUB        =this.ACTION.substring(0,1)=="@";
        this.RENDER     =""     ;
        }
function MenuListAPPEND(label,action)   //Appends an item to the menuobject
        {
        this.Items[this.Items.length]=new MenuItem(label,action);
        if(label.length>this.greatestCharWidth)this.greatestCharWidth=label.length;
        }
function menuPop(tobj,imgId,imgSrc) //Pops up menu relative to <A> tag location on screen.
        {
        if ((imgId)&&(imgSrc))imgSwap(imgId,imgSrc);
        objectName=tobj.href.substring(tobj.href.lastIndexOf("/")+1);
        if(objectName.indexOf(".html")>-1)objectName=objectName.substring(0,objectName.indexOf("."))
//      if(!menuCurrentPath)return;
        if(menuCurrentPath.indexOf(":"+objectName+":")==0)return false;
        if(menuCurrentPath.length>0)menuPOPDN();
if(szDuds.indexOf(navigator.userAgent)>-1)
{
if(tobj.href.indexOf(".html")==-1)tobj.href+=".html";
return true;
}

        if(navigator.appVersion.indexOf("MSIE")>-1&&navigator.appVersion.indexOf("Mac")>-1)
          {// compatible mac
          if(tobj.href.indexOf(".html")==-1)tobj.href+=".html";
          return true;
          }

        this.MX=((systemIsNS)?(tobj.x):window.event.clientX-window.event.offsetX+tobj.offsetLeft);
        this.MY=((systemIsNS)?(tobj.y):window.event.clientY-window.event.offsetY+tobj.offsetTop);
        if(!systemIsNS)MSIEmeasure(tobj,this);    
        this.MY+=menuYpopoff;
        this.MX+=menuXpopoff;
        menuPOPUP(this.MX,this.MY,objectName);
        menuTimeOut=setTimeout("menuPOPDN()",menuAtimeout);
        return false;
        }
function menuPOPUP(x,y,menulist)        //*** Opens named menu at given location
        {
        var DL=eval(menulist);
        if(!DL){alert("menuPOPUP NULL "+menulist);return;}
        menuSHOW(menulist,x,y);
        if(!menuScreenWidth)
          menuScreenWidth=(systemIsNS)?document.width:document.body.offsetWidth;
        mkw=(DL.greatestCharWidth*menuCharWidth)+10;
        var atX = ((x+mkw+20)>=menuScreenWidth)?x-mkw:x;
        if(jsLAYERgetX(DL.mPANEL)!=atX)menuXY(DL,atX,y);
        }
function menuCREATE(szMlist,iLeft,iTop)
        {
        Left= 20;Top = 40;
        if(menuCREATE.arguments.length>1)Left=iLeft;
        if(menuCREATE.arguments.length>2)Top=iTop;
        Mlist=eval(szMlist);
        if(Mlist.mPANEL ==null)
          {
          Mlist.mPANEL=new jsMPANELclass(szMlist,0,"Hello","alert('hi')",Left,Top,((Mlist.greatestCharWidth+10)*menuCharWidth)+1,((menuCharHeight+1)*Mlist.Items.length)+1);
          Mlist.mPANEL.mParent=Mlist;
          var menuContent='';
          menuContent='<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD>';
          for(x=0;x<Mlist.Items.length;x++)
           {
           menuContent+=menuLABEL(Mlist.mPANEL,Mlist.Items[x].LABEL,false,Mlist.Items[x].SUB);
           Mlist.Items[x].RENDER=menuLABEL(Mlist.mPANEL,Mlist.Items[x].LABEL,true,Mlist.Items[x].SUB);
           }
        menuContent+='</TD><TD BGCOLOR="#000000">&nbsp;</TD>';
        menuContent+="</TR><TR><TD COLSPAN=2>&nbsp;</TD></TR></TABLE>";
//alert(menuContent);
          jsLAYERsetContent(Mlist.mPANEL,menuContent);
          }
        if(Mlist.mSELECT==null)
          {
          Mlist.mSELECT=new jsMSELECTclass(szMlist,1,"Hello","alert('hi')",Left,Top,(Mlist.greatestCharWidth+10)*menuCharWidth,menuCharHeight);
          Mlist.mSELECT.mParent=Mlist;
          jsLAYERsetContent(Mlist.mSELECT,Mlist.Items[0].RENDER);
          }
        }

function menuSHOW(szMlist,iLeft,iTop)   // SHOW the menu
        {
        Left= 20;Top = 40;
        if(menuSHOW.arguments.length>1)Left=iLeft;
        if(menuSHOW.arguments.length>2)Top=iTop;
        Mlist=eval(szMlist);
        if(Mlist.mPANEL==null)menuCREATE(szMlist,iLeft,iTop);
        if(jsLAYERgetX(Mlist.mPANEL)!=Left || jsLAYERgetY(Mlist.mPANEL)!=Top)
            {
            jsLAYERxy(Mlist.mPANEL,Left,Top)   
            jsLAYERxy(Mlist.mSELECT,Left,Top+(Mlist.EntryNum*(menuCharHeight+1)));
            }; 
        if(menuCurrentPath.indexOf(":"+szMlist+":")<0)menuCurrentPath+=((menuCurrentPath.length)?"":":")+szMlist+":";

        if(Mlist.mPANEL.style.clip&&!systemIsNS)
          {
          Clips= Mlist.mPANEL.style.clip.split("rect(")[1].split(")")[0].split("px")
          Clips[2]=Mlist.Items.length * (menuCharHeight+1);
          Mlist.mPANEL.style.clip = "rect("+Array(0,Clips[1],Clips[2],0).join("px ")+"px)";
          Mlist.mPANEL.style.zIndex=5;
          Mlist.mSELECT.style.zIndex=6;
          }
        Mlist.mPANEL.style.visiblity='visible';
//alert(Mlist.Items.length +" Item(s) "+ Mlist.mPANEL.style.clip);
        jsLAYERshow(Mlist.mPANEL,true);
        jsLAYERshow(Mlist.mSELECT,true);
        }
function menuHIDE(szMlist)      //  Hides the named menu
        {
        Mlist=eval(szMlist);
        jsLAYERshow(Mlist.mSELECT,false);
        jsLAYERshow(Mlist.mPANEL,false);
        }
function menuXY(Mlist,x,y)      // Moves the referenced menu
        {
        jsLAYERxy(Mlist.mPANEL,x,y)
        jsLAYERxy(Mlist.mSELECT,x,y+(Mlist.EntryNum*(menuCharHeight+1)));
        }
function menuPOPDN(treeList)    // closes a list of menus
        {
        if(menuTimeOut)clearTimeout(menuTimeOut);
        if(menuPOPDN.arguments.length<1)treeList=menuCurrentPath;
        while(treeList.length>1)
             {          
             killboy =treeList.substring(1);
             killboy =killboy.substring(0,killboy.indexOf(":"));
             treeList=treeList.substring(killboy.length+1);
             menuHIDE(killboy);
             }
        if(menuPOPDN.arguments.length<1)menuCurrentPath="";
        };
/*
** MAIN MENU OBJECT
*/
var mSELECT=null;
function MenuList(Mlist)
        {
        this.mPANEL=null;this.mSELECT=null;
        this.Items=new Array();this.EntryNum=0;
        this.APPEND=MenuListAPPEND;
        this.greatestCharWidth=0;
        }

/*      Function        :MSIEmeasure
**      Since I have found no straight forward method of obtaining IE x,y
**      coords for the clicked link, this function recurses up the object tree
**      to measure the screen location of the <A> involved
*/
function MSIEmeasure(btobj,HB)
        {
        var tobj=btobj;
        HB.MX=tobj.offsetLeft;
        HB.MY=tobj.offsetTop;
        while(tobj.parentElement)
          {
          if(!tobj.parentElement)break;
          tobj = tobj.parentElement;
//        if(tobj.tagName=="TABLE")
          if(String(":TABLE:TD:DIV:").indexOf(":"+tobj.tagName+":")>-1)
            {
            HB.MX+=tobj.offsetLeft;
            HB.MY+=tobj.offsetTop;
            }
          if(!tobj.parentElement)break;
          if(tobj.parentElement.tagName=="BODY")break;
          }
        return ;
        }
/****************************************
** A message window                     *
*****************************************/
var StatusMsgWin=null;
function jsMESSAGEclass(group,entry,x,y,w,h)
        {
        this.lyrName            =group+entry;
        if(!document.all[this.lyrName])jsLAYERcreateLayer(this,x,y,w,h,"#FFFFCC");
        jsLAYERsetHandler(this,"jsNULLvector");
        jsLAYERshow(this,true);
        this.jsLAYERobject.GROUP=group;this.jsLAYERobject.ENTRY=entry;
        }
/*
** Set the contents of the message window;
*/
function jsStatusMsg(txtMESSAGE)
        {
        if(!StatusMsgWin)
          {
          StatusMsgWin= new jsMESSAGEclass("E",1,1,1,355,100);
          jsLAYERshow(StatusMsgWin,true);
          }
        jsLAYERsetContent(StatusMsgWin,txtMESSAGE);
        }
var LIBLOADEDJSmenu=true;
//systemLibCnt++; 

</SCRIPT>

<SCRIPT language=JavaScript>
<!--
var image1;
preLoad();
function preLoad() {
if (document.images) {
image1= new Image();
image1.src = "http://invite.ke2.informative.com/images/invite.gif";
if (image1.complete){
InviteUser() ;
}else{
setTimeout('everySecond()',1000);
}
}
}
function everySecond(){
if (image1.complete){
InviteUser() ;
}
}
function InviteUser(){
var strURL ="http://invite.ke2.informative.com/i.dll?s=23803&c=i&i=P&xu=embed&CLOSE=1";
window.open ( strURL, "", "toolbar=no,toolbar=0,location=no,location=0,status=no,status=0,menubar=no,menubar=0,scrollbars=yes,scrollbars=1,resizable=yes,resizable=1,width=1,height=1,top=3000,left=3000,alwaysRaised=1" ); 
}
//-->
// Copyright 1997-2000 Informative, Inc</SCRIPT>

<META content="MSHTML 6.00.2600.0" name=GENERATOR></HEAD>
<BODY text=#000000 vLink=#663399 aLink=#6699cc link=#0000ff bgColor=#ffffff 
leftMargin=0 topMargin=0 rightMargin=0><FONT 
face="Verdana, Georgia, Arial, Sans-Serif" size=2><!-- ad width = 468  - ad height = 60 -->
<TABLE cellSpacing=0 cellPadding=0 width=780 border=0>
  <TBODY>
  <TR bgColor=#666699>
    <TD vAlign=bottom align=left bgColor=#666699 rowSpan=2><A 
      href="http://www.embedded.com/"><IMG 
      src="Embedded Systems - Protected Mode-Dateien/embedded_top.jpg" 
      width=302 border=0 HIEGHT="119"></A><BR></TD><!-- TOP BANNER -->
    <TD vAlign=top align=middle bgColor=#666699 colSpan=2>
      <SCRIPT language=JavaScript>
<!--
var plugin = (navigator.mimeTypes && navigator.mimeTypes["application/x-shockwave-flash"]) ? navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin : 0;
if ( plugin ) {
 plugin = parseInt(plugin.description.substring(plugin.description.indexOf(".")-1)) >= 4;
}
else if (navigator.userAgent && navigator.userAgent.indexOf("MSIE")>=0 && (navigator.userAgent.indexOf("Windows 95")>=0 || navigator.userAgent.indexOf("Windows 98")>=0 || navigator.userAgent.indexOf("Windows NT")>=0)) {
 document.write('<SCR' + 'IPT LANGUAGE=VBScript\> \n');
 document.write('on error resume next \n');
 document.write('plugin = ( IsObject(CreateObject("ShockwaveFlash.ShockwaveFlash.4")))\n');
 document.write('if ( plugin <= 0 ) then plugin = ( IsObject(CreateObject("ShockwaveFlash.ShockwaveFlash.5")))\n');
 document.write('<\/SCR' + 'IPT\> \n');
}
if ( plugin ) {
 document.write('<OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"');
 document.write('  codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=4,0,2,0" ');
 document.write(' ID=flashad WIDTH=468 HEIGHT=60>');
 document.write(' <PARAM NAME=movie VALUE="http://img.cmpnet.com/ads/graphics/cs/ke/flash11.swf?clicktag=http://newads.cmpnet.com/event.ng/Type%3dclick%26ProfileID%3d3362%26RunID%3d38792%26AdID%3d29258%26GroupID%3d1%26FamilyID%3d1%26TagValues%3d178.1831%26Redirect%3dhttp:%2f%2fwww.microsoft.com/redirect.asp?PageID=165&PARAM=WEMBONL&TARGET=/windows/Embedded/trial/evalkit.asp"> <PARAM NAME=quality VALUE=autohigh> '); 
 document.write(' <EMBED src="http://img.cmpnet.com/ads/graphics/cs/ke/flash11.swf?clicktag=http://newads.cmpnet.com/event.ng/Type%3dclick%26ProfileID%3d3362%26RunID%3d38792%26AdID%3d29258%26GroupID%3d1%26FamilyID%3d1%26TagValues%3d178.1831%26Redirect%3dhttp:%2f%2fwww.microsoft.com/redirect.asp?PageID=165&PARAM=WEMBONL&TARGET=/windows/Embedded/trial/evalkit.asp" quality=autohigh ');
 document.write(' NAME=flashad swLiveConnect=FALSE WIDTH=468 HEIGHT=60 ');
 document.write(' TYPE="application/x-shockwave-flash" PLUGINSPAGE="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash">');
 document.write(' </EMBED>');
 document.write(' </OBJECT>');
} else if (!(navigator.appName && navigator.appName.indexOf("Netscape")>=0 && navigator.appVersion.indexOf("2.")>=0)){
 document.write('<A TARGET="_top" HREF="http://newads.cmpnet.com/event.ng/Type=click&ProfileID=3362&RunID=38792&AdID=29258&GroupID=1&FamilyID=1&TagValues=178.1831&Redirect=http:%2f%2fwww.microsoft.com/redirect.asp?PageID=165&PARAM=WEMBONL&TARGET=/windows/Embedded/trial/evalkit.asp"><IMG SRC="http://img.cmpnet.com/ads/graphics/cs/ke/windows_default.gif" WIDTH=468 HEIGHT=60 BORDER=0></A>');
}
//-->
</SCRIPT>
      <NOEMBED><A 
      href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=3362&amp;RunID=38792&amp;AdID=29258&amp;GroupID=1&amp;FamilyID=1&amp;TagValues=178.1831&amp;Redirect=http://www.microsoft.com/redirect.asp?PageID=165&amp;PARAM=WEMBONL&amp;TARGET=/windows/Embedded/trial/evalkit.asp" 
      target=_top><IMG height=60 
      src="Embedded Systems - Protected Mode-Dateien/windows_default.gif" 
      width=468 border=0></A></NOEMBED><NOSCRIPT><A 
      href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=3362&amp;RunID=38792&amp;AdID=29258&amp;GroupID=1&amp;FamilyID=1&amp;TagValues=178.1831&amp;Redirect=http://www.microsoft.com/redirect.asp?PageID=165&amp;PARAM=WEMBONL&amp;TARGET=/windows/Embedded/trial/evalkit.asp" 
      target=_top><IMG height=60 
      src="Embedded Systems - Protected Mode-Dateien/windows_default.gif" 
      width=468 border=0></A></NOSCRIPT><BR></TD></TR>
  <TR>
    <TD vAlign=bottom align=right bgColor=#666699><IMG height=50 hspace=0 
      src="Embedded Systems - Protected Mode-Dateien/blend_top.gif" 
      width=387 border=0><BR></TD>
    <TD vAlign=bottom align=right width=91 bgColor=#666699 height=50><IMG 
      height=50 hspace=0 
      src="Embedded Systems - Protected Mode-Dateien/edtnlogo.gif" 
      width=91 border=0><BR></TD></TR></TBODY></TABLE><!-- TOP NAV -->
<TABLE cellSpacing=1 cellPadding=0 width=780 border=0>
  <TBODY>
  <TR bgColor=#333366>
    <TD align=middle width=130><A 
      href="http://www.edtn.com/encyclopedia/"><IMG height=16 
      alt="EDTN Encyclopedia" 
      src="Embedded Systems - Protected Mode-Dateien/e_cyclo.gif" 
      width=94 border=0></A></TD>
    <TD align=middle width=130><A href="http://www.embedded.com/98/"><IMG 
      height=16 alt=Home 
      src="Embedded Systems - Protected Mode-Dateien/home.gif" 
      width=42 border=0></A></TD>
    <TD align=middle width=130><A href="http://www.edtn.com/register/"><IMG 
      height=16 alt="Register for the EDTN Network" 
      src="Embedded Systems - Protected Mode-Dateien/register.gif" 
      width=68 border=0></A></TD>
    <TD align=middle width=130><A 
      href="http://www.embedded.com/contact.htm"><IMG height=16 alt=Contact 
      src="Embedded Systems - Protected Mode-Dateien/about.gif" 
      width=73 border=0></A></TD>
    <TD align=middle width=130><A 
      href="http://www.embedded.com/advertising.html"><IMG height=16 
      alt=Advertising 
      src="Embedded Systems - Protected Mode-Dateien/advert.gif" 
      width=97 border=0></A></TD>
    <TD align=middle width=130><A 
      href="mailto:wbiondi@cmp.com?subject=Feedback from Embedded.com"><IMG 
      height=16 alt=Feedback 
      src="Embedded Systems - Protected Mode-Dateien/feeback.gif" 
      width=68 border=0></A></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=780 border=0>
  <TBODY>
  <TR><!-- LEFTNAV -->
    <TD vAlign=top align=left width=205 rowSpan=2>
      <TABLE cellSpacing=0 cellPadding=0 width=205 border=0>
        <TBODY>
        <TR>
          <TD vAlign=top align=left width=21 bgColor=#666699>&nbsp;</TD>
          <TD vAlign=top align=left width=18 bgColor=#ffffcc><IMG height=18 
            src="Embedded Systems - Protected Mode-Dateien/curve_lav.gif" 
            width=18 border=0><BR></TD>
          <TD vAlign=top align=left width=166 bgColor=#ffffcc>&nbsp;</TD></TR><!-- LEFTTOC -->
        <TR>
          <TD bgColor=#666699>&nbsp;</TD>
          <TD vAlign=top align=left width=184 bgColor=#ffffcc colSpan=2>
            <TABLE cellSpacing=0 cellPadding=0 width=184 border=0>
              <TBODY>
              <TR>
                <TD vAlign=top align=middle bgColor=#ffffcc>
                  <CENTER><A 
                  href="http://www.cmpnet.com/cgi-bin/goto?SRC=ESCSF_REG&amp;URL=http://www.esconline.com/sf/register.htm"><IMG 
                  height=42 alt="REGISTER NOW!" 
                  src="Embedded Systems - Protected Mode-Dateien/escsf_sm.gif" 
                  width=124 border=0></A></CENTER><!-- SEARCH -->
                  <FORM action=/search method=get><IMG height=21 
                  src="Embedded Systems - Protected Mode-Dateien/esearch.gif" 
                  width=184> <INPUT name=queryText><BR><INPUT type=submit value=Search name=Search> 
                  <BR><FONT face="verdana, georgia, arial" size=1><A 
                  href="http://www.edtn.com/esearchcenter.html"><B>Search the 
                  EDTN Network</B></A></FONT> </FORM></TD></TR>
              <TR>
                <TD vAlign=top align=left bgColor=#ffffcc><!-- EMBEDDED.COM LINKS --><IMG height=19 
                  alt="Embedded.com Links" 
                  src="Embedded Systems - Protected Mode-Dateien/embedd_links.gif" 
                  width=184><BR><A onmouseover="imgSwap('esconf','esconfon',1)" 
                  onmouseout="imgSwap('esconf','esconfoff',1)" 
                  href="http://www.esconline.com/"><IMG height=35 
                  src="Embedded Systems - Protected Mode-Dateien/es_conf.gif" 
                  width=184 border=0 name=esconf></A><BR><A 
                  onmouseover="imgSwap('mag','magon',1)" 
                  onmouseout="imgSwap('mag','magoff',1)" 
                  href="http://www.embedded.com/mag.htm"><IMG height=35 
                  src="Embedded Systems - Protected Mode-Dateien/esp_mag.gif" 
                  width=184 border=0 name=mag></A><BR><A 
                  onmouseover="imgSwap('ia','iaon',1)" 
                  onmouseout="imgSwap('ia','iaoff',1)" 
                  href="http://www.embedded.com/internet/"><IMG height=20 
                  src="Embedded Systems - Protected Mode-Dateien/ia.gif" 
                  width=184 border=0 name=ia></A><BR><A 
                  onmouseover="imgSwap('down','downon',1)" 
                  onmouseout="imgSwap('down','downoff',1)" 
                  href="http://www.embedded.com/code.htm"><IMG height=21 
                  src="Embedded Systems - Protected Mode-Dateien/code.gif" 
                  width=184 border=0 name=down></A><BR><A 
                  onmouseover="imgSwap('demo','demoon',1)" 
                  onmouseout="imgSwap('demo','demooff',1)" 
                  href="http://www.embedded.com/demos.htm"><IMG height=19 
                  src="Embedded Systems - Protected Mode-Dateien/prod_demos.gif" 
                  width=184 border=0 name=demo></A><BR><A 
                  onmouseover="imgSwap('res','reson',1)" 
                  onmouseout="imgSwap('res','resoff',1)" 
                  href="http://www.embedded.com/links.htm"><IMG height=21 
                  src="Embedded Systems - Protected Mode-Dateien/resources.gif" 
                  width=184 border=0 name=res></A><BR><A 
                  onmouseover="imgSwap('ie','ieon',1)" 
                  onmouseout="imgSwap('ie','ieoff',1)" 
                  href="http://www.embedded.com/events.htm"><IMG height=19 
                  src="Embedded Systems - Protected Mode-Dateien/ind_ev.gif" 
                  width=184 border=0 name=ie></A><BR><A 
                  onmouseover="imgSwap('guide','guideon',1)" 
                  onmouseout="imgSwap('guide','guideoff',1)" 
                  href="http://www.embedded.com/bg/"><IMG height=20 
                  src="Embedded Systems - Protected Mode-Dateien/buyers.gif" 
                  width=184 border=0 name=guide></A><BR><A 
                  onmouseover="imgSwap('site','siteon',1)" 
                  onmouseout="imgSwap('site','siteoff',1)" 
                  href="http://www.embedded.com/sitemap.htm"><IMG height=20 
                  src="Embedded Systems - Protected Mode-Dateien/sitemap.gif" 
                  width=184 border=0 name=site></A><BR><!--NEW PRODUCTS--><IMG 
                  height=19 alt="NEW Products" 
                  src="Embedded Systems - Protected Mode-Dateien/new_prodheader.gif" 
                  width=184> 
                  <TABLE><FONT face=VERDANA size=1>
                    <TBODY>
                    <TR>
                      <TD vAlign=top align=left><IMG 
                        src="Embedded Systems - Protected Mode-Dateien/blackarrow_lg.gif"> 
                      </TD>
                      <TD align=left><FONT face=VERDANA size=1><A 
                        href="http://www.embedded.com/story/OEG20020215S0071">Atmel 
                        offers design tool for programmable SoCs</A> 
                    </FONT></TD></TR>
                    <TR>
                      <TD vAlign=top align=left><IMG 
                        src="Embedded Systems - Protected Mode-Dateien/blackarrow_lg.gif"> 
                      </TD>
                      <TD align=left><FONT face=VERDANA size=1><A 
                        href="http://www.embedded.com/story/OEG20020215S0065">Communications 
                        processor supports by-wire systems</A> </FONT></TD></TR>
                    <TR>
                      <TD vAlign=top align=left><IMG 
                        src="Embedded Systems - Protected Mode-Dateien/blackarrow_lg.gif"> 
                      </TD>
                      <TD align=left><FONT face=VERDANA size=1><A 
                        href="http://www.embedded.com/story/OEG20020213S0050">MEN 
                        Micro board sports I/O options</A> 
                  </FONT></TD></TR></TBODY></TABLE>
                  <P align=right><A href="http://www.embedded.com/products">More 
                  New Products</A> <IMG 
                  src="Embedded Systems - Protected Mode-Dateien/blackarrow.gif"> 
                  <BR><BR></FONT><!-- COMPANY STORE PRODUCTS --><IMG height=19 
                  alt="Company Store" 
                  src="Embedded Systems - Protected Mode-Dateien/companystore_header.gif" 
                  width=184><BR><A onmouseover="imgSwap('direct','directon',1)" 
                  onmouseout="imgSwap('direct','directoff',1)" 
                  href="http://www.embedded.com/directories/"><IMG height=22 
                  src="Embedded Systems - Protected Mode-Dateien/catalogs.gif" 
                  width=184 border=0 name=direct></A><BR><A 
                  onmouseover="imgSwap('cdrom','cdromon',1)" 
                  onmouseout="imgSwap('cdrom','cdromoff',1)" 
                  href="http://www.embedded.com/cdrom.htm"><IMG height=22 
                  src="Embedded Systems - Protected Mode-Dateien/cdrom.gif" 
                  width=184 border=0 name=cdrom></A><BR><A 
                  onmouseover="imgSwap('embeddedbooks','embeddedbookson',1)" 
                  onmouseout="imgSwap('embeddedbooks','embeddedbooksoff',1)" 
                  href="http://www.embedded.com/books.htm"><IMG height=22 
                  src="Embedded Systems - Protected Mode-Dateien/embeddedbooks.gif" 
                  width=184 border=0 name=embeddedbooks></A><BR><A 
                  onmouseover="imgSwap('jobs','jobson',1)" 
                  onmouseout="imgSwap('jobs','jobsoff',1)" 
                  href="http://www.embedded.com/jobs.htm"><IMG height=20 
                  src="Embedded Systems - Protected Mode-Dateien/job.gif" 
                  width=184 border=0 name=jobs></A> <!-- SPONSORED MICROSITES --><!--<IMG SRC="http://img.cmpnet.com/embedded/redesign/microsites.gif" ALT="Sponsored Microsites" WIDTH="184" HEIGHT="19"><BR>


<A HREF="http://embeddeddsp.embedded.com" 
onMouseOver="imgSwap('welcome','welcomeon',1)" onMouseOut="imgSwap('welcome','welcomeoff',1)"><IMG SRC="http://img.cmpnet.com/embedded/redesign/welcometo.gif" ALT="Welcome to Embedded DSP by TI" WIDTH="184" HEIGHT="33" BORDER="0" NAME="welcome"></A>--></P></TD></TR></TBODY></TABLE><BR 
            clear=all><!-- top left tile ad call-->
            <CENTER><A 
            href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=4880&amp;RunID=25778&amp;AdID=27339&amp;GroupID=1&amp;FamilyID=2883&amp;TagValues=450.1831&amp;Redirect=http://www.embedded.com" 
            target=_top><IMG alt="Click here!" 
            src="Embedded Systems - Protected Mode-Dateien/Embedded125.gif" 
            border=1></A> </CENTER><!--- end of top left tile ad--><BR><!-- botom left tile ad call-->
            <CENTER><A 
            href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=4882&amp;RunID=25781&amp;AdID=16823&amp;GroupID=1&amp;FamilyID=340&amp;TagValues=453.1831&amp;Redirect=http://www.planetanalog.com" 
            target=_top><IMG alt="Click here!" 
            src="Embedded Systems - Protected Mode-Dateien/pa125.gif" 
            border=1></A> </CENTER><!--- end of bottom left tile ad--><BR>
            <TABLE cellSpacing=0 cellPadding=0 width=184 border=0>
              <TBODY>
              <TR>
                <TD vAlign=top align=right bgColor=#ffffcc><!-- AROUND THE NETWORK --><IMG height=11 
                  alt="From around the network" 
                  src="Embedded Systems - Protected Mode-Dateien/around.gif" 
                  width=184 vspace=3><BR><!-- GLOBAL PORTALS --><IMG height=19 
                  alt="Global Portals" 
                  src="Embedded Systems - Protected Mode-Dateien/gb2.gif" 
                  width=184><BR><FONT face=VERDANA,ARIAL size=1><A 
                  href="http://www.edtn.com/">EDTN Network</A><BR><A 
                  href="http://www.edtneurope.com/">EDTN Europe</A><BR><A 
                  href="http://www.edtnasia.com/">EDTN Asia</A><BR><BR><!-- COMMUNITIES --><IMG height=19 
                  alt=Communities 
                  src="Embedded Systems - Protected Mode-Dateien/frontbut-commun.gif" 
                  width=184><BR><FONT face=VERDANA,ARIAL size=1><A 
                  href="http://www.eedesign.com/">EEdesign</A><BR><I>Design 
                  tools and methodologies</I><BR><A 
                  href="http://www.planetanalog.com/">Planet 
                  Analog</A><BR><I>The analog/mixed signal resource</I><BR><A 
                  href="http://www.commsdesign.com/">Comms Design</A><BR><I>The 
                  analog/mixed signal resource</I><BR><A 
                  href="http://www.siliconstrategies.com/">Silicon 
                  Strategies</A><BR><I>Tracking the semiconductor 
                  foodchain</I><BR><A 
                  href="http://www.gaas.net/">GaAsNET</A><BR><I>GaAs electronics 
                  industry resource</I><BR><A 
                  href="http://www.embedded.com/">Embedded.com</A><BR><I>Embedded 
                  systems resource</I><BR><A 
                  href="http://www.theworkcircuit.com/">The Work 
                  Circuit</A><BR><I>Where Engineers make their own 
                  connections</I><BR><A 
                  href="http://www.iapplianceweb.com/">iApplianceWeb</A><BR><I>Information 
                  appliance resource</I><BR></FONT><!--network jump menu -->
                  <SCRIPT>
<!--
function MM_jumpMenu(targ,selObj,restore){ //v3.0
  eval(targ+".location='"+selObj.options[selObj.selectedIndex].value+"'");
  if (restore) selObj.selectedIndex=0;
}
//-->
</SCRIPT>

                  <FORM name=form1><IMG height=19 alt="EDTN sites worldwide" 
                  src="Embedded Systems - Protected Mode-Dateien/side-wwsites2.gif" 
                  width=184 vspace=2><BR><FONT 
                  face="Verdana, Arial, Helvetica, sans-serif" size=1><SELECT 
                  onchange="MM_jumpMenu('parent',this,1)" size=2 
                  name="network links"> <OPTION selected>Please select a 
                    site</OPTION> <OPTION value=http://www.edtn.com/>EDTN 
                    Network</OPTION> <OPTION 
                    value=http://www.allembedded.com>Allembedded</OPTION> 
                    <OPTION value=http://www.chipcenter.com>ChipCenter</OPTION> 
                    <OPTION value=http://www.circuitsassembly.com>Circuits 
                    Assembly</OPTION> <OPTION 
                    value=http://www.commsdesign.com>Comms Design</OPTION> 
                    <OPTION value=http://www.csdmag.com>Comms Sys 
                    Design</OPTION> <OPTION 
                    value=http://www.us.design-reuse.com>Design &amp; 
                    Reuse</OPTION> <OPTION value=http://www.edtneurope.com>EDTN 
                    Europe</OPTION> <OPTION 
                    value=http://www.edtnscandinavia.com>EDTN 
                    Scandinavia</OPTION> <OPTION 
                    value=http://www.eedesign.com>EEdesign</OPTION> <OPTION 
                    value=http://www.eetimes.com>EE Times</OPTION> <OPTION 
                    value=http://www.ebnonline.com/>Electronic Buyers 
                    News</OPTION> <OPTION 
                    value=http://www.electronica-world.com>Electronica 
                    World</OPTION> <OPTION 
                    value=http://www.electronicstimes.co.uk>Electronics 
                    Times</OPTION> <OPTION 
                    value=http://www.embedded.com>Embedded.com</OPTION> <OPTION 
                    value=http://www.gaasnet.com>GaAsNET</OPTION> <OPTION 
                    value=http://www.hdi-online.com>HDI</OPTION> <OPTION 
                    value=http://www.isdmag.com>Int Sys Design</OPTION> <OPTION 
                    value=http://www.mwee.com>Microwave Engineering</OPTION> 
                    <OPTION 
                    value=http://www.planetanalog.com>PlanetAnalog</OPTION> 
                    <OPTION value=http://www.pcdmag.com>Printed Circuit 
                    Design</OPTION> <OPTION value=http://www.pcfab.com>PC 
                    Fab</OPTION> <OPTION 
                    value=http://www.pcnalert.com>PCNalert.com</OPTION> <OPTION 
                    value=http://www.powerdesigners.com>PowerDesigner</OPTION> 
                    <OPTION value=http://www.semibiznews.com>Semi Business 
                    News</OPTION> <OPTION 
                    value=http://www.techcareers.co.uk>Techcareers</OPTION> 
                    <OPTION value=http://www.wnie.com>What's New in 
                    Electronics</OPTION></SELECT> </FONT></FORM><BR><!-- encyclopedia link --><A 
                  href="http://www.edtn.com/encyclopedia/"><IMG height=19 
                  alt=e-cyclopedia 
                  src="Embedded Systems - Protected Mode-Dateien/side-elec_ind2.gif" 
                  width=184 vspace=2 border=0></A><BR><!-- netseminar link --><A 
                  href="http://www.netseminar.com/"><IMG height=19 
                  alt=NetSeminar 
                  src="Embedded Systems - Protected Mode-Dateien/side-netseminar2.gif" 
                  width=184 vspace=3 border=0></A><BR><!-- alerts link --><A 
                  href="http://www.edtn.alerts.com/edtn/fs_main.jsp" 
                  target=new><IMG height=19 alt=Alerts 
                  src="Embedded Systems - Protected Mode-Dateien/side-alerts2.gif" 
                  width=184 vspace=3 border=0></A> </FONT><!--
<P ALIGN="CENTER"><a href="http://www.edtn.com/shared/redirect?url=/howiwork/?site=embedded"><IMG SRC="http://img.cmpnet.com/commsdesign/pics/howiwork_trans.gif" ALT="Howiwork" WIDTH="120" HEIGHT="74" BORDER="0"></A></P>
--></TD></TR></TBODY></TABLE></TD></TR><!-- Corporate LOGO -->
        <TR>
          <TD bgColor=#666699>&nbsp;</TD>
          <TD>&nbsp;</TD>
          <TD vAlign=top align=right>
            <CENTER><IMG height=65 alt="Corporate Logo" 
            src="Embedded Systems - Protected Mode-Dateien/ubm_white.gif" 
            width=70></CENTER></TD></TR>
        <TR>
          <TD vAlign=top align=middle colSpan=3><FONT face=verdana,arial 
            size=1>Copyright © 2002 CMP Media LLC<BR><A 
            href="http://www.cmpnet.com/delivery/privacy.html">Privacy 
            Statement</A></FONT> </TD></TR></TBODY></TABLE></TD><!-- END LEFT NAV --><!-- BODY -->
    <TD vAlign=top align=left width=433 bgColor=#ffffff>
      <TABLE cellSpacing=0 cellPadding=0 width=433 border=0>
        <TBODY>
        <TR>
          <TD vAlign=top align=left width=18 bgColor=#ffffff><IMG height=18 
            src="Embedded Systems - Protected Mode-Dateien/curve_yell.gif" 
            width=18 border=0><BR></TD>
          <TD vAlign=top align=left width=415 bgColor=#ffffff>
        <TR>
          <TD vAlign=top align=left width=18 bgColor=#ffffff>&nbsp;</TD>
          <TD vAlign=top align=left width=415 bgColor=#ffffff><!-- TITLE Embedded x86 Programming: Protected Mode -->
            <META content="Embedded x86 Programming: Protected Mode" name=title>
            <META content="April 1998" name=issue>
            <META content="Jean Gareau" name=author><FONT 
            face="Verdana, Georgia, Sans-Serif" size=2>
            <CENTER><BR><IMG height=67 
            src="Embedded Systems - Protected Mode-Dateien/esplogo.gif" 
            width=329><BR><BR></CENTER>
            <H3>Embedded X86 Programming: Protected Mode </H3><I><B>By Jean 
            Gareau </B></I>
            <P>Intel has shipped millions of 80386, 80486, and Pentiums since 
            1986, and this figure is increasing rapidly. The x86 is expected to 
            seriously affect the embedded systems market for the following 
            reasons: applications can be developed on a PC (not necessarily on a 
            target), both 16-bit and 32-bit programming are fully supported, a 
            complete diversity of hardware is available, and GUI 
            featuresthrough Windows CE and 95will become more accessible. 
            <SUP>1 </SUP>
            <P>Consequently, many existing RTOSs will likely be ported to this 
            CPUif not completely rewritten from scratchto exploit the x86s 
            capabilities. This CPU and its successors are armed with a battery 
            of features that enables the implementation of the most advanced 
            concepts in operating system design. These features also allow the 
            writing of simpler embedded applications by providing 32-bit 
            operations and various memory models that give applications large 
            address space. Development tools (compilers and linkers) also have 
            some benefits, because popular memory models, such as the flat 
            memory version, are simpler to support. 
            <P>This article initiates a series presenting in-depth technical 
            coverage of the most important features: protected mode (the subject 
            of this article), segmentation, and paging. Functional examples are 
            provided with each article to illustrate the concepts. To understand 
            segmentation and paging concepts and how they can simplify embedded 
            application development, the protected mode must first be explained 
            in detail. 
            <P>Complete examples that implement various kernel designsfully 
            documented and testedcan be downloaded from the <I>ESP </I>Web site 
            at <I>www.embedded.com/code.htm</I>. These examples demonstrate the 
            concepts Ill explain in this series, including a port of mC/OS to 
            protected mode. <SUP>2 </SUP>The source code is provided, as well as 
            ready-to-run executables and additional tools. These various 
            implementations will provide a start to help you improve your 
            applications or even implement your own system. 
            <P><B>REVIEWING THE REAL MODE </B>
            <P>Protected mode has its roots in the 8086 processor, the ancestor 
            of the 32-bit 80386. The 8086, although a 16-bit CPU, provides a 
            clever mechanism to access up to 1MB of physical (real) memory: real 
            mode. This addressing mode relies on a combination of segment and 
            offset registers to address bytes in memory (instruction or data). 
            Each instruction uses one of the four segment registers available, 
            either implicitly or explicitly. Address calculation is done by 
            shifting a segment register by four (multiplying by 16) and adding 
            one of the nine general registers, typically the one specified in 
            the instruction (see <A 
            href="http://img.cmpnet.com/embedded/gifs/9804fe21.gif">Figure 
            1</A>). The result is a 20-bit address, providing 1MB of address 
            space and using 16-bit registers. The carry bit (bit 20) is 
            discarded. 
            <P>Since a single segment register allows accessing 64K, multiple 
            segments are required to access more memory. Most developers 
            involved in Intel application development have heard of the various 
            memory models that were popular not so long ago: tiny, small, 
            medium, compact, large, and huge. These models proposed various 
            segment combinations in order to overcome the 16-bit limitation when 
            accessing code and data beyond 64K. 
            <P>To push the 1MB limitation further, some complex schemes were 
            introduced, such as the expanded and extended memory. These schemes 
            helped, but they also increased memory management complexity and 
            consequently, introduced overhead. 
            <P>Compilers, linkers, and operating system loaders had the 
            responsibility of assigning proper values to segment registers, to 
            free the application developers from doing so. System programmers, 
            writing programs mainly in assembly, were not so lucky and had to 
            cope with this complex scheme. The source of all this complexity was 
            the infamous 64K limitation due to the 16-bit nature of the CPU. 
            <P><B>INTRODUCING THE PROTECTED MODE </B>
            <P>In 1986, with the advent of the Intel 80386, things really 
            started to change. For one, this processor is a real 32-bit 
            processor. The main advantages of 32-bit programming over 16-bit and 
            8-bit programming are speed and simplicity. Instructions themselves 
            are usually faster and a single instruction (string and memory 
            operations, arithmetic, and so forth) can work on 32 bits at the 
            same speed as two 16-bit instructions or four 8-bit instructions. 
            Reducing the number of instructions reduces program sizes and speeds 
            up execution, because fewer instructions have to be fetched and 
            decoded. Smaller size and faster execution are always welcome in 
            embedded systems. 
            <P>Second, this CPUs memory management unit (MMU) introduces a new 
            addressing mode over real mode called protected mode. This mode 
            offers a high degree of flexibility, making possible very large 4GB 
            flat address space per task or per application (no segment) and up 
            to 64 terabytes (thats 64,000,000,000,000 bytes) of virtual memory! 
            This mode also adds some protection in order to run the software 
            that needs it, such as Unix-like systems have. Advanced memory 
            concepts and protection will be covered in subsequent articles. 
            <P>In protected mode, the segment registers are indexes into special 
            tables, all initialized and maintained by the operating system, but 
            interpreted by the CPU. There are three types of tables, all located 
            either in RAM or ROM: 
            <P>
            <P>* The Global Descriptor Table (GDT), unique, always accessible 
            <P>**The Local Descriptor Table (LDT), usually one per task. Zero, 
            one, or many may be present in the system, but only one, if any, is 
            active at all times 
            <P>**The Interrupt Descriptor Table (IDT), used when interrupts are 
            raised 
            <P>Each table contains a variable number of descriptors and an 
            8-byte data structure that describes a memory region with the 
            following attributes (see <A 
            href="http://img.cmpnet.com/embedded/gifs/9804fe22.gif">Figure 
            2</A>): 
            <P>
            <P>**The base address in memory (32-bit) 
            <P>**The limit (20-bit), expressed either in 4K or 1-byte units 
            <P>**Control bits: the granularity bit (limits unit), present bit 
            (useful with swapping), and two protection bits 
            <P>**The descriptor type, one of the 16 supported, among them: 
            executable, read-only code segment; data segment; stack segment; 
            call, trap, or interrupt gate; task state segment, and others 
            <P>Segment registers are selectors (indexes) into either the GDT or 
            the LDT (the IDT entries are only used when an interrupt is raised). 
            A selector (such as a segment register) contains a 13-bit index, a 
            1-bit table identification (GDT/LDT), and a 2-bit protection level. 
            See <A 
            href="http://img.cmpnet.com/embedded/gifs/9804fe23.gif">Figure 
            3</A>. 
            <P>A logical address, as used by a program, is still the combination 
            of a segment and a general register, or more precisely, a 16-bit 
            selector and a 16-bit or 32-bit offset. The selector identifies a 
            descriptor, which in turn provides a 32-bit base address, to which 
            the offset is added, forming a final linear 32-bit address as seen 
            in <A href="http://img.cmpnet.com/embedded/gifs/9804fe24.gif">Figure 
            4</A>. This 32-bit addressing supports up to 4GB (2 <SUP>32 </SUP>) 
            of memory. 
            <P>All memory accesses within the segment can be done with the 
            offset only, simplifying program coding. This address calculation 
            provides many advantages: 
            <P>
            <P>* Because segment registers cover up to 4GB individually, they 
            dont have to be constantly reloaded, even with huge data 
            structures, reducing complexity and increasing speed 
            <P>* Offsets always start at zero, independently of the segments 
            location in physical memory, making it easier to debugthe addresses 
            (offsets, for example) never change. Segments can be moved in 
            physical memory without affecting the applications that use them 
            <P>* An offset must be within the segment's limit; if it isnt, an 
            exception is raised and the operating system, which typically 
            catches it, may stop the faulty application. This feature prevents 
            incorrect memory access, such as jumping outside the code segment or 
            accessing out-of-segment data 
            <P>* Segments are protected against undesired access, thanks to 
            their descriptors. For instance, an application cannot write into a 
            code segment, which is read-only. Another similar example is to 
            prevent executing from a data segment 
            <P>* This addressing mode provides a phenomenal virtual address 
            space. Because a selectors index is a 13-bit value, the GDT and LDT 
            tables are limited to 8,192 descriptors (2 <SUP>13 </SUP>). One 
            single descriptor can cover up to 4GB (with a base address of zero, 
            a limit of 1MB (FFFFFh), and the granularity bit set, making the 
            limit a 4K-unit value (4K x 1MB = 4GB)). Considering that the GDT 
            and the active LDT together have a maximum of 16,384 descriptors, 
            the total virtual address space is 64 terabytes (16K * 4GB). 
            Although this is astronomical, one must realize that segmentation 
            always produces a 32-bit linear address, limiting the physical 
            address space to 4GB, still quite sufficient 
            <P>* One embedded operating system may use a few segments, whereas 
            another may use hundreds of them, as illustrated in <A 
            href="http://img.cmpnet.com/embedded/gifs/9804fe25.gif">Figure 
            5</A>. In (a), an embedded application can reside in the operating 
            system with a single segment covering 4GB. In (b), the same 
            application might own its proper segments, all distinct from the 
            operating system segments. These various approaches can be justified 
            depending on the system constraints. 
            <P><B>MIXING 16-BIT AND 32-BIT CODE </B>
            <P>Protected mode is not synonymous with 32-bit. The Intel CPUs, in 
            protected mode, support 16-bit and 32-bit segments. This makes them 
            ideal CPUs to run legacy 16-bit applications as well as new 32-bit 
            systems. 
            <P>Most x86 assemblers support some directives to indicate whether a 
            specific segment of code will be executed in 16-bit mode (the USE16 
            directive) or in 32-bit (USE32). The assembler will generate the 
            appropriate code, but its up to the operating system to load the 
            task adequatelythat is, to ensure the USE16 segments are run in 
            16-bit mode and USE32 segments are run in 32-bit mode. 
            <P>By comparing disassembled 16-bit with 32-bit code, one notices 
            many similarities, as shown in <A 
            href="ftp://ftp.mfi.com/pub/espmag/1998/gareau.txt">Listing 1</A>. 
            For instance, the 16-bit instruction xor ax,ax (line 2) and the 
            32-bit instruction xor eax,eax (line 7) produce identical opcodes 
            (33h C0h). How does the CPU make the difference between the 16-bit 
            AX and 32-bit EAX registers? This has to do with the current segment 
            mode. Whenever the code segmentthe CS segment registeris loaded 
            with a selector, the CPU loads the descriptor into an internal, 
            inaccessible register (reserved for the CPU only) and analyzes its 
            type. One bit in the descriptor determines whether this is a 16-bit 
            or 32-bit segment. If this is a 16-bit segment, the opcodes 33h C0h 
            mean xor ax,ax; if this is a 32-bit segment, they mean xor eax,eax. 
            In a 16-bit code segment, opcodes work with 16-bit operands and 
            addresses; in a 32-bit code segment, opcodes work on 32-bit operands 
            and addresses. Consequently, the CPU has only one instruction set 
            and it works for both 16-bit and 32-bit modes. 
            <P>To provide maximum flexibility, the opcodes 66h and 67h 
            respectively override the operand and address size. For example, in 
            a 16-bit code segment, 66h 33h C0h (line 3) would work on 32-bit EAX 
            whereas the same instruction, in a 32-bit code segment (line 8), 
            would affect only the lower 16-bit AX. 
            <P>This condition is made possible because the CPU really has one 
            and only one bank of 32-bit general registers. Its the current CPU 
            mode (either real mode, 16-bit protected mode, or 32-bit protected 
            mode) that indicates whether 16-bit or 32-bit operands and addresses 
            are used and how they are used. Typically, the size override opcodes 
            are used in 16-bit code to access 32-bit values. They are rarely 
            used in 32-bit application code. 
            <P>Serious incompatibilities between 16-bit and 32-bit code still 
            exist, especially regarding the address mode encoding (the 32-bit 
            mode supports more addressing modes) and the addresses themselves 
            (encoded over 16 or 32 bits), as shown in <A 
            href="ftp://ftp.mfi.com/pub/espmag/1998/gareau.txt">Listing 2</A>. 
            The 16-bit instruction lea ax,MyVar (line 2) has no direct opcode 
            equivalent in a 32-bit segment, even with size override opcodes 
            (lines 6 and 7). 
            <P>Mixing 16-bit and 32-bit code is more than often an issue and 
            should be avoided whenever possible. There is, however, one case in 
            which this mix cant be avoided: upon starting up, the CPU starts 
            running in real mode. A 32-bit system will have to switch into 
            32-bit protected mode and will have to mix at some point or another 
            some 16-bit code (system initialization) and 32-bit code (rest of 
            the system). 
            <P>If both your assembler and linker accept 16-bit and 32-bit 
            segments, you can simply put the real mode code into a USE16 segment 
            and the 32-bit protected mode code into a USE32 segment. Once the 
            16-bit code is ready to go 32-bit, it simply jumps into the USE32 
            segment. The two segments dont have to be part of the same program, 
            although having two programs doesnt always make things simpler. I 
            prefer to keep the initialization in one single source file. 
            <P>Again, this solution only works if your tools fully support a 
            16-bit and 32-bit code mix. Unfortunately, some recent tools only 
            support flat memory model and do not fully support 16-bit code. For 
            instance, some linkers will not permit a jump from a 16-bit segment 
            into a 32-bit one. However, switching into 32-bit protected mode 
            requires exactly that. Thus, the issue becomes how to write 16-bit 
            instructions with tools that only support 32-bit programming. 
            <P>The solution is to write the 16-bit code in 32-bit segments. Now 
            this is not trivial, because mnemonics will be assembled as 32-bit 
            instructions, and they will cause problems when theyre executed in 
            real mode. Using size override opcodes may not entirely resolve the 
            issue because some instructions are simply incompatible, as shown in 
            <A href="ftp://ftp.mfi.com/pub/espmag/1998/gareau.txt">Listing 
            2</A>. Simply put, 16-bit instructions cannot be written as such in 
            a 32-bit segment. But theres still a solution. 
            <P>By disassembling the real-mode instructions from a 16-bit, you 
            can directly put the resulting opcodes in a 32-bit segment, using 
            assembly directives such as DB, DW (which allow you to enter values 
            in numerical form). This is really directly encoding 16-bit 
            instructions. I agree that this isnt a high-tech solution, although 
            the use of macros can maintain the codes readability. Also, the 
            16-bit portion typically consists of a few instructions and it 
            affects little code overall. Furthermore, these few instructions are 
            unlikely to change. This method is demonstrated a little bit 
            further. 
            <P>There are other alternatives. If you are designing a 16-bit 
            system, you are free to stay in 16-bit as long as you want, by 
            writing everything in a USE16 segment and either far jumping into a 
            16-bit segment or not jumping at all (since the CPU maintains a 
            valid code segment after the protected mode is activated, as we will 
            see later). This method obviously requires tools that support 16-bit 
            programming. 
            <P><B>ACTIVATING THE PROTECTED MODE </B>
            <P>Now lets take a look at an example that shows how to activate 
            protected mode. This example starts in real mode and switches into 
            protected mode in order to execute 32-bit code in a flat memory 
            model. See <A 
            href="ftp://ftp.mfi.com/pub/espmag/1998/gareau.txt">Listing 3</A>. 
            The purpose of this example is to demonstrate basic protected mode 
            concepts; if youre looking for ready-to-run examples, be sure to 
            take a look at those at <I>www.embedded.com/code </I>. 
            <P>This example assumes that after the CPU has been reset, some 
            system tests have successfully run, the interrupts have been 
            disabled, and the CPU is still running in real mode. The BIOS, if 
            any, is ignored because it works only in real mode and is irrelevant 
            in protected mode. The code can be run anywhere in the first 1MB of 
            memory. 
            <P>I used Microsofts Macro Assembler (MASM) v. 6.11, the latest 
            revision. Also, instead of using the provided linker, I used 
            Microsoft Visual C++ v. 5.0s linker, which is the latest 
            incremental linker from Microsoft. This linker generates COFF file 
            executable, which is the standard under Windows NT (MASMs linker 
            outputs less popular OMF files). The incremental linker has one 
            drawback: it doesnt fully support 16-bit segments. Consequent-ly, 
            16-bit instructions must be directly encoded, as I explained 
            earlier. 
            <P>The shortest way to execute 32-bit code is to load the GDT, 
            activate the protected mode, and jump into a 32-bit segment. This 
            order is not strict, though. For instance, you may first activate 
            the protected mode, load the GDT, and make the jump. Either way is 
            the same. 
            <P>The GDT in <A 
            href="ftp://ftp.mfi.com/pub/espmag/1998/gareau.txt">Listing 3</A> is 
            already constructed (lines 97 to 121). Even if you intend to 
            dynamically add descriptors in it later, you can initially have it 
            with a few static descriptors right from the start. In the example, 
            the GDT occupies 24 bytes and contains three entries: 
            <P>
            <P>* Entry 0 is null. This entry cannot be referred to; segment 
            registers can be initialized to zero (thus pointing to it), but 
            using them raises an exception. This feature is aimed at identifying 
            NULL far pointer references. Nevertheless, it could contain some 
            data because the descriptor is never used by the CPU. In the 
            example, it simply contains zero 
            <P>* Entry 1 (Selector 08h) is used for kernel code, with a base of 
            zero, a limit of FFFFFh, with the granularity bit set (making the 
            limit 4GB), and the type set to executable, read-only code 
            <P>* Entry 2 (Selector 10h) is used for kernel data, also with a 
            base of zero, a limit of FFFFFh, granularity bit set but with a type 
            of writable segment. This data segment overlaps the code segment. 
            Together, they provide a flat memory address space 
            <P>The GDT is loaded by initializing the GDTR register with the GDT 
            base address and size, both stored in a 6-byte data structure (line 
            61). The GDTR register is normally loaded by executing the 16-bit 
            instruction lgdt fword ptr address. But this instruction cannot be 
            written as such because the resulting 32-bit opcodes will not work 
            in real mode (the address mode will be incorrect). To make things 
            worse, addresses must be expressed as 32-bit values (a linker 
            constraint), whereas 16-bit values are normally expected in real 
            mode. To overcome this problem I used the 16-bit instructions mov 
            ebx,address and lgdt fword ptr [bx], encoded in the LGDT32 macro 
            (lines 17 to 25), and called from line 47. The address is specified 
            as a 32-bit value, although only the lowest 16-bit portion is used. 
            But above all, it properly loads the GDT register while the CPU is 
            running in real mode. 
            <P>With the GDT register set, protected mode is activated by setting 
            bit #0 in the CR0 register (lines 49 to 51). CR0 is a control 
            register that controls segmentation and paging, among other things. 
            CR0 can only be read from or written to by using register operands 
            (no memory nor immediate operands). The example uses the AX 
            register, although the opcodes will use EAX when executed in real 
            mode. As soon as the bit is set in CR0, protected mode kicks in and 
            the CPU starts executing 16-bit instructions, but in protected mode 
            (segment registers become indexes into a table). 
            <P>The content of all segment registers is unknown at this point. 
            However, it is guaranteed that they can still be used to access 
            subsequent instructions or data. And immediately after the protected 
            mode is activated, the CPUs instruction queue must be flushed 
            because it contains pre-fetched real mode instructions, no longer 
            valid in protected mode. The queue can be flushed by executing a 
            jump to the next instruction (line 52). 
            <P>The last thing to do in 16-bit is to switch to 32-bit. This step 
            is achieved by loading the code segment register (CS) with a 
            selector referring to a 32-bit executable code descriptor. The 
            second entry in the GDT is such a descriptor. At line 57, the FJMP32 
            jump macro (lines 27 to 32) is executed with the selector 08h and 
            the Start32 offset. Because the descriptor contains a base address 
            of zero, the offset simply has to be the physical location of the 
            first instruction to execute in 32-bit mode. In this case, this 
            instruction is at Start32 (line 65). The entry into the 32-bit mode 
            marks the end of the 16-bit code (as well as the tricky encoded 
            instructions). 
            <P>Once in 32-bit mode, the best thing to do is initialize the data 
            registers (DS, ES, FS, GS) and the stack register (SS) (lines 73 to 
            78). Note that there are 16-bit and 32-bit stack segments: the size 
            determines how many bytes (two or four) a normal push saves on the 
            stack (the push and pop opcodes are identical in 16-bit and 32-bit). 
            The example uses the third GDT entry as a combined data and 32-bit 
            stack segment (selector 10h). Finally, ESP (the stack pointer) is 
            set to an arbitrary top of stack. 
            <P>And thats itthe code is running in 32-bit protected mode, in a 
            flat address space of 4GB! A complete system would have to continue 
            its initialization, such as loading and initializing the Interrupt 
            Descriptor Table (IDT), set-up some hardware, and so on. These 
            issues are beyond the scope of the article, although they are fully 
            addressed in the examples that can be downloaded from the Web site. 
            The next articles will explore segmentation (including protection) 
            and paging in detail. 
            <P><A href="ftp://ftp.embedded.com/pub/1998/gareau.txt">
            <H4>Listings </H4></A><I>Jean Gareau graduated from the Polytechnic 
            School of the University of Montreal in 1992 with an M.S. in 
            electrical engineering. He has been involved since 1989 in the 
            development of operating systems, system tools, and large commercial 
            applications. He can be reached at jeangareau@yahoo. com. </I>
            <P><B>REFERENCES </B>
            <P>1. Ganssle, Jack G., Future Challenges, <I>Embedded Systems 
            Programming </I><I>1997 Buyers Guide </I>, p. 7. 
            <P>2. Labrosse, Jean J. m <I>C/OS The Real-Time Kernel </I>. 
            Lawrence, KS: R&amp;D Publications, Fourth Printing, 1992. 
            <P><B>Other Sources </B>
            <P><I>80386 Programmers Reference Manual </I>, Order Number 
            230985-001, Chandler, AZ: Intel Corp., 1987. 
            <P><I>Reference: Microsoft MASM 6.11 </I>, Document Number 
            DB35749-1292, Redmond, WA: Microsoft Corp., 1992. 
            <P><I>Programmers Guide: Microsoft MASM 6.11 </I>, Document Number 
            DB35747-1292, Redmond, WA: Microsoft Corp., 1992. <A 
            href="http://www.embedded.com/98/9805fe2.htm">
            <H4>Jump to Part 2 </H4></A></FONT></TD></TR></TBODY></TABLE></TD><!-- RIGHT NAV -->
    <TD vAlign=top align=left width=142 bgColor=#ffffff>
      <P><NOBR><IMG height=100 alt="" 
      src="Embedded Systems - Protected Mode-Dateien/spacer.gif" 
      width=8> <A 
      href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=4878&amp;RunID=25777&amp;AdID=19650&amp;GroupID=1&amp;FamilyID=2300&amp;TagValues=1831.1910.2474&amp;Redirect=http://www.edtn.com/shared/redirect?url=http://www.edtn.com&amp;source_code=45" 
      target=_top><IMG height=600 alt="cLICK HERE" 
      src="Embedded Systems - Protected Mode-Dateien/edtn_interruptflames2.gif" 
      width=125 border=1></A></NOBR> </P></TD></TR><!-- SPONSORED LINK & BOTTOM AD -->
  <TR>
    <TD vAlign=top align=middle colSpan=2><BR clear=all>
      <CENTER>
      <TABLE borderColor=#000000 cellSpacing=0 cellPadding=0 border=1>
        <TBODY>
        <TR>
          <TD vAlign=top align=left width=468>
            <TABLE cellSpacing=0 cellPadding=5 border=0>
              <TBODY>
              <TR>
                <TD colSpan=2><FONT face=verdana,arial size=2><B>Sponsor 
                  Links</B></FONT> </TD></TR>
              <TR>
                <TD vAlign=top align=left width=234><FONT face=verdana,arial 
                  size=2><B>Wind River</B><BR><A 
                  href="http://newads.cmpnet.com/adclick/event.ng/Type=click&amp;ProfileID=4907&amp;RunID=38972&amp;AdID=29393&amp;Redirect=http://ad.doubleclick.net/clk;3821090;6834914;j?http://www.windriver.com/products/html/eval_center.html">Work 
                  with lots of code? Try Wind River's SNiFF+ source code 
                  analysis tool - FREE</A> 
                  <P><B>Microsoft</B><BR><A 
                  href="http://newads.cmpnet.com/adclick/event.ng/Type=click&amp;ProfileID=4908&amp;RunID=38765&amp;AdID=29263&amp;Redirect=http://www.microsoft.com/redirect.asp?PageID=165&amp;PARAM=WEMBONL&amp;TARGET=/windows/Embedded/trial/evalkit.asp">Order 
                  your Windows Embedded Evaluation Software today!</A></FONT> 
                  </P></TD>
                <TD vAlign=top align=left width=234><FONT face=verdana,arial 
                  size=2><B>EDTN Mobile News</B><BR><A 
                  href="http://newads.cmpnet.com/adclick/event.ng/Type=click&amp;ProfileID=4909&amp;RunID=26084&amp;AdID=21164&amp;Redirect=http://www.edtn.com/palm/download.html/" 
                  target=_TOP>The latest news now available to go. <BR>Palm VII 
                  users click here</A> 
                  <P><B>Planet Analog</B><BR><A 
                  href="http://newads.cmpnet.com/adclick/event.ng/Type=click&amp;RunID=27017&amp;AdID=21162&amp;ProfileID=4910&amp;GroupID=1&amp;FamilyID=1&amp;TagValues=804.1785.1831.1913&amp;Redirect=http://www.edtn.com/register/newsletters" 
                  target=_TOP>Sign up for FREE Analog Newsletter 
                  Now!</A></A></FONT> 
      </P></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></CENTER>
      <P>
      <CENTER><A 
      href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=3543&amp;RunID=19436&amp;AdID=27334&amp;GroupID=1&amp;FamilyID=2882&amp;TagValues=179.1831&amp;Redirect=http://www.planetanalog.com" 
      target=_top><IMG alt="Click here!" 
      src="Embedded Systems - Protected Mode-Dateien/lifeonmars_2.gif" 
      border=0></A><BR></CENTER></TD></TR></TBODY></TABLE><!-- END BODY --></FONT></BODY></HTML>
