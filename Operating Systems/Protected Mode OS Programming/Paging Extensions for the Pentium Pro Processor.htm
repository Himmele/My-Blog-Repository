<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0047)http://x86.ddj.com/articles/2mpages/2mpages.htm -->
<HTML><HEAD><TITLE>Paging Extensions for the Pentium Pro Processor (Overview)</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<META content="MSHTML 6.00.2600.0" name=GENERATOR></HEAD>
<BODY text=#000000 vLink=#330066 aLink=#ff0000 link=#0000ff bgColor=#ffffff 
leftMargin=8 
background="Paging Extensions for the Pentium Pro Processor-Dateien/back3.gif" 
topMargin=8 MARGINHEIGHT="8" MARGINWIDTH="8">
<TABLE cellSpacing=0 cellPadding=0 border=0>
  <TBODY>
  <TR><!--------------- LEFT SIDE ------------>
    <TD vAlign=top><FONT face=arial,helvetica size=-1><A 
      href="http://x86.ddj.com/"><IMG height=90 
      src="Paging Extensions for the Pentium Pro Processor-Dateien/logo_small.gif" 
      width=115 align=top border=0></A><BR clear=all><!-- Left side nav items: two-column table, bullets in left column -->
      <TABLE cellSpacing=0 cellPadding=0 width=128 border=0>
        <TBODY>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/dot.gif" 
            width=7 VALIGN="top"></TD>
          <TD><A href="http://www.ddj.com/"><IMG height=20 alt="DDJ Home" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/ddjhome.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD><IMG height=5 alt="" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/spacer.gif" 
            width=1 align=top><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/dot.gif" 
            width=7 VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/news/hotnews.htm"><IMG height=40 
            alt="Today's Headlines" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/newnews.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/dot.gif" 
            width=7 VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/news/old.htm"><IMG height=20 
            alt="Past Headlines" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/pastnews.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/dot.gif" 
            width=7 VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/articles/articles.htm"><IMG 
            height=40 alt="Microprocessor Articles" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/m_articles.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/dot.gif" 
            width=7 VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/secrets/intelsecrets.htm"><IMG 
            height=20 alt="Intel Secrets" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/intel.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/dot.gif" 
            width=7 VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/errata/errataseries.htm"><IMG 
            height=20 alt="Intel Errata" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/errata.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/dot.gif" 
            width=7 VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/ddj/ddj.htm"><IMG height=40 
            alt="Undocumented Corner" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/udoc.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/dot.gif" 
            width=7 VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/intel.doc/inteldocs.htm"><IMG 
            height=40 alt="Processor Manuals" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/pmanual.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/dot.gif" 
            width=7 VALIGN="top"></TD>
          <TD><A 
            href="http://x86.ddj.com/intel.doc/intelmotherboards.htm"><IMG 
            height=40 alt="Motherboard Manuals" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/mmanual.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/dot.gif" 
            width=7 VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/links.htm"><IMG height=20 alt=Links 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/links.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD><IMG height=50 alt="" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/spacer.gif" 
            width=1 align=top><BR clear=all></TD></TR>
        <TR>
          <TD align=left colSpan=2><!-- REMOTE AD CALL <%/remoteviewad?site=x86&pagepos=buttonsponsor|site=x86|pagepos=buttonsponsor%> --><A 
            href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=6783&amp;RunID=38371&amp;AdID=25450&amp;GroupID=304&amp;FamilyID=2749&amp;TagValues=2901.2949&amp;Redirect=http://www.sdmagazine.com" 
            target=_top><IMG height=1 alt="" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/clear_1x1.gif" 
            width=1 border=0></A> <!-- REMOTE AD CALL <%/remoteviewad?site=ddj&pagepos=buttonsponsor&uri=nav-bottom|uri=nav-bottom|site=ddj|pagepos=buttonsponsor%> --><!-- AD ERROR: No profiles found to match request (site=ddj, pagepos=buttonsponsor, server_name=, uri=)--></TD></TR></TBODY></TABLE></FONT></TD><!-- End left-hand column --><!--------------- MAIN BODY ------------>
    <TD vAlign=top>
      <TABLE cellSpacing=0 cellPadding=0 border=0>
        <TBODY>
        <TR>
          <TD><!-- First row: ad --><!-- REMOTE AD CALL <%/remoteviewad?site=x86&pagepos=top|site=x86|pagepos=top%> --><A 
            href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=7160&amp;RunID=39005&amp;AdID=29421&amp;GroupID=320&amp;FamilyID=1&amp;TagValues=178.2949&amp;Redirect=http://www.microsoft.com/redirect.asp?PageID=157&amp;PARAM=TECWDOB&amp;TARGET=http://msdn.microsoft.com/events/teched/" 
            target=_top><IMG height=60 alt="" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/micro_contest_2.gif" 
            width=468 border=1></A> </TD></TR>
        <TR>
          <TD 
          background="Paging Extensions for the Pentium Pro Processor-Dateien/dash_wide.gif"><!-- 2nd row: rule --><IMG 
            height=10 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/spacer.gif" 
            width=1> </TD></TR>
        <TR>
          <TD><!-- 3rd row: Header --><IMG height=40 
            alt="Microprocessor Resources" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/microprocessor.gif" 
            width=350><BR clear=all><IMG height=10 
            src="D:\Eigene Dateien\OS Programming\Paging Extensions for the Pentium Pro Processor-Dateien\spacer(1).gif" 
            width=1><BR></TD></TR>
        <TR>
          <TD><!-- 4th row: Page content -->
            <P align=center><IMG height=100 
            alt="Page Address Extensions on the Pentium Pro Processory -- by Robert Collins" 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/pae_title.gif" 
            width=600></P>
            <P>Most people never knew that the Pentium's original design 
            included 36-bit addressing, and the capability to access 2M page 
            sizes. These extensions were known as <B>Page Address Extensions</B> 
            (PAE), and were to be enabled in CR4. When CR4.PAE=1 (CR4[5]=1), 
            page address extensions were enabled. When CR4.PAE=0, A[35..32] were 
            forced to 0, regardless of what addresses could be generated in 
            protected mode with a descriptor pointing near 4G, and an offset 
            pointing above the 4G address space. Even when CR4.PAE=1, addresses 
            above 4G would not be generated unless they were the result of a 
            page-mode, paging translation. The only means to access memory above 
            4G was through these extensions to page mode. This document will 
            describe PAE based on what little I know from the Pentium, and from 
            preliminary P6 literature. This document will also include 
            extensions to PAE that are exclusive to P6.</P>
            <P>Whether or not PAE was ever implemented in the Pentium beyond the 
            conceptual stage is not known. But vestiges of its existence are 
            visible throughout the Pentium documentation and architecture. There 
            are at least four references to 2M pages in the various Pentium 
            manuals[<A 
            href="http://x86.ddj.com/articles/2mpages/2mpages.htm#ref1">1</A>,<A 
            href="http://x86.ddj.com/articles/2mpages/2mpages.htm#ref2">2</A>,<A 
            href="http://x86.ddj.com/articles/2mpages/2mpages.htm#ref3">3</A>,<A 
            href="http://x86.ddj.com/articles/2mpages/2mpages.htm#ref4">4</A>]. 
            In addition to these documentation references, CR4[5] is marked 
            reserved, and was to enable PAE; CPUID.flags[6] is marked reserved 
            and was to indicate the existence of PAE; the MSR TR8 is marked 
            reserved, and contained the upper 4 address bits used for TLB 
            testability. Now it appears that the P6 is going to implement 36-bit 
            addressing and 2M page sizes.</P>
            <P>To support 36-bit addressing, it is necessary to make substantial 
            changes to the paging mechanism. 32-bit linear addresses are still 
            used, but they are translated to 36-bit physical addresses. Intel 
            choose to use a three-tier paging mechanism to support PAE for 4K 
            pages, and a two-tier mechanism for 2M pages. When CR4.PAE=1, CR3 
            points to a small table of <B>Page Directory Pointers</B> (PDPs). 
            Each PDP entry references a separate page directory. Each page 
            directory points to a page table, for 4K pages, or directly to the 
            page frame, for 2M pages. <A 
            href="http://x86.ddj.com/articles/2mpages/2mpages.htm#fig1">Figure 
            1</A> gives a detailed description of all of the CPU structures 
            associated with page translations while PAE is enabled. For 
            comparative purposes, <A 
            href="http://x86.ddj.com/articles/2mpages/2mpages.htm#fig2">Figure 
            2</A> gives a detailed description of all of the CPU structures 
            associated with page translations while <B>Page Size Extensions</B> 
            (PSE) is enabled (4-Mbyte pages).</P>
            <P><A name=Fig1></A><B>Figure 1</B> -- Paging Structures for PAE</P>
            <P align=center><IMG height=455 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/paefig1.gif" 
            width=866></P>
            <P><A name=Fig2></A><B>Figure 2</B> -- Paging Structures for PSE</P>
            <P align=center><IMG height=377 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/paefig2.gif" 
            width=865></P>
            <P>In addition to CR4.PAE, which enables Page Address Extensions, 
            CR4 contains another addition to enhance page mode performance. 
            CR4.PGE (bit-7) enables <B>Paging Global Extensions</B> (PGE). PGE 
            determines whether moves to CR3 flush all of the PTE's from the TLB, 
            or only those whose G-bit (global bit) is not set. Likewise, for 
            task switches which implicitly set CR3, CR4.PGE controls TLB 
            flushing in the same manner.</P>
            <P>As shown in Figure 1, CR3 is still a 32-bit register, and 
            therefore the PDP must reside within the first 4G address space. 
            Each PDP is selected by the upper 2 bits of the linear address -- 
            A[31..30]. Therefore the PDP contains only 4 entries. Each PDP entry 
            points to the physical address of a page directory, and is 64-bits 
            wide, though only 36-bits are used. Therefore, each PDP can 
            reference a page directory anywhere in the 64G address space. The 
            index into the Page Directory (PDE) is determined by the linear 
            address bits -- A[29..21]. The Page Directory is therefore limited 
            to 512 entries (2^9) of 8-bytes each. Even though the PDE has been 
            reduced to 512 entries, its structure takes up the same amount of 
            memory space when CR4.PAE=0 (4096 bytes), because of the increase in 
            its element size (to 8-bytes). For 4K pages, each 8-byte PDE points 
            to the physical address of the Page Table. For 2M pages, each 8-byte 
            PDE points to the physical address of the page frame, itself. For 4K 
            pages, the index of the Page Table Entry (PTE) is determined by the 
            linear address bits -- A[20..12]. Similar to the PDE, each Page 
            Table is limited to 512 entries of 8-bytes each; each 8-byte entry 
            pointing to the physical <B>Page Frame Address</B> (PFA). <A 
            href="http://x86.ddj.com/articles/2mpages/2mpages.htm#fig3">Figure 
            3</A> shows the page translation for 4K pages while CR4.PAE=1.</P>
            <P><A name=Fig3></A><B>Figure 3</B> -- Page Translation for 4K Page 
            Address Extensions</P>
            <P align=center><IMG height=415 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/paepict1.gif" 
            width=801></P>
            <P>Page translation for 2M pages is virtually identical to 4M page 
            translations. The main difference between the two translation 
            mechanism, is the addition of the PDP reference, and the number of 
            index bits in the PDE. Like 4K page translations with PAE enabled, 
            each PDP entry points to the physical address of a page directory. 
            The index into the Page Directory (PDE) is determined by linear 
            address bits -- A[29..21]. The remaining address bits in the linear 
            address, A[20..00], are used to directly index into the page frame. 
            Since the offset is 21-bits wide, the page size is 2M (2^21). <A 
            href="http://x86.ddj.com/articles/2mpages/2mpages.htm#fig4">Figure 
            4</A> shows a diagram of page translations for 2M pages.</P>
            <P><A name=Fig4></A><B>Figure 4</B> -- Page Translation for 2M Page 
            Address Extensions</P>
            <P align=center><IMG height=393 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/paepict2.gif" 
            width=713></P>
            <P>Some distinction needs to be made as to whether PAE and PSE are 
            mutually exclusive, and which has a higher precedence. Likewise, 
            what is the role of the PDE.PS bit when the page address extensions 
            are enabled. I will assume the two features are mutually exclusive, 
            and that PAE has higher precedence than PSE. Therefore, <A 
            href="http://x86.ddj.com/articles/2mpages/2mpages.htm#tbl1">Table 
            1</A> details a description for possible combinations of PAE, PSE, 
            and PDE.PS.</P>
            <P><A name=Tbl1></A><B>Table 1</B> -- Control bits for Paging 
            Extensions</P>
            <P align=center><IMG height=234 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/paetbl1.gif" 
            width=751></P>
            <P align=center>Definition of fields in paging structure 
figures:</P>
            <P align=center><IMG height=993 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/paetbl2.gif" 
            width=820> </P>
            <HR>

            <H2>Endnotes:</H2>
            <OL>
              <LI><A name=Ref1></A>The PentiumTM Processor User's Manual Volume 
              1 (241428-001), Chapter 2 Overview, paragraph 8. 
              <LI><A name=Ref2></A>The PentiumTM Processor User's Manual Volume 
              1 (241428 all revisions), Figure 3-4. 
              <LI><A name=Ref3></A>The PentiumTM Processor at iCOMPTM Index 
              735\90 MHz (241997 all revisions), Section 1.1, paragraph 5. 
              <LI><A name=Ref4></A>The PentiumTM Processor at iCOMPTM Index 
              610\75 MHz (242323-001), Section 2.1, paragraph 7. </LI></OL>
            <HR>

            <P><A href="http://x86.ddj.com/secrets/intelsecrets.htm#paeptr">Back 
            to Intel Secrets and Bugs</A></P>
            <P><A href="http://x86.ddj.com/articles/articles.htm#paeptr">Back to 
            Books and Articles home page</A></P></TD></TR>
        <TR>
          <TD 
          background="Paging Extensions for the Pentium Pro Processor-Dateien/dash_wide.gif"><!-- rule --><IMG 
            height=10 
            src="Paging Extensions for the Pentium Pro Processor-Dateien/spacer.gif" 
            width=1> </TD></TR>
        <TR>
          <TD><!-- Bottom Advertisement -->
            <TABLE cellSpacing=0 cellPadding=1 width=490 bgColor=#cccccc 
            border=0>
              <TBODY>
              <TR>
                <TD vAlign=center align=middle><FONT face=Arial 
                  size=1>Advertisement</FONT> </TD></TR>
              <TR>
                <TD vAlign=center align=middle><!-- REMOTE AD CALL <%/remoteviewad?site=x86&pagepos=bottom|site=x86|pagepos=bottom%> --><!-- begin contestbanner -->
                  <FORM action=http://www.powells.com/cgi-bin/partner 
                  method=post>
                  <TABLE cellSpacing=0 cellPadding=0 width=468 border=0>
                    <TBODY>
                    <TR>
                      <TD align=left width=346 bgColor=#990000><IMG height=60 
                        src="Paging Extensions for the Pentium Pro Processor-Dateien/contestbannernew.gif" 
                        width=346></TD>
                      <TD align=middle width=122 bgColor=#990000><FONT 
                        face="Verdana, Helvetica, Arial" color=#ffffff 
                        size=-3><B>email address:</B></FONT><BR><INPUT size=11 
                        name=email><BR><INPUT type=image height=17 width=48 
                        src="Paging Extensions for the Pentium Pro Processor-Dateien/enterbuttonnew.gif" 
                        vspace=5 border=0></TD></TR></TBODY></TABLE><!-- Replace the XXX in the line below with your Partnership ID Number --><INPUT 
                  type=hidden value=25231 name=partner_id> <!-- So, if your ID Number were 999, the above line would read ...name=partner_id value=999 --><INPUT 
                  type=hidden value=newsletter_box.cgi name=cgi> </FORM><!-- end contestbanner --></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD><!-- Copyright message --><FONT face="Arial, Helvetica" 
            size=-1>Copyright © 2002 <I>Dr. Dobb's 
        Journal<BR></I></FONT></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></BODY></HTML>
