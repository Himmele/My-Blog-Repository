<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0049)http://x86.ddj.com/articles/probemd/probemode.htm -->
<HTML><HEAD><TITLE>Overview of Pentium Probe Mode</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<META content="MSHTML 6.00.2600.0" name=GENERATOR></HEAD>
<BODY text=#000000 vLink=#330066 aLink=#ff0000 link=#0000ff bgColor=#ffffff 
leftMargin=8 background="Overview of Pentium Probe Mode-Dateien/back3.gif" 
topMargin=8 MARGINHEIGHT="8" MARGINWIDTH="8">
<TABLE cellSpacing=0 cellPadding=0 border=0>
  <TBODY>
  <TR><!--------------- LEFT SIDE ------------>
    <TD vAlign=top><FONT face=arial,helvetica size=-1><A 
      href="http://x86.ddj.com/"><IMG height=90 
      src="Overview of Pentium Probe Mode-Dateien/logo_small.gif" width=115 
      align=top border=0></A><BR clear=all><!-- Left side nav items: two-column table, bullets in left column -->
      <TABLE cellSpacing=0 cellPadding=0 width=128 border=0>
        <TBODY>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Overview of Pentium Probe Mode-Dateien/dot.gif" width=7 
            VALIGN="top"></TD>
          <TD><A href="http://www.ddj.com/"><IMG height=20 alt="DDJ Home" 
            src="Overview of Pentium Probe Mode-Dateien/ddjhome.gif" width=120 
            border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD><IMG height=5 alt="" 
            src="Overview of Pentium Probe Mode-Dateien/spacer.gif" width=1 
            align=top><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Overview of Pentium Probe Mode-Dateien/dot.gif" width=7 
            VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/news/hotnews.htm"><IMG height=40 
            alt="Today's Headlines" 
            src="Overview of Pentium Probe Mode-Dateien/newnews.gif" width=120 
            border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Overview of Pentium Probe Mode-Dateien/dot.gif" width=7 
            VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/news/old.htm"><IMG height=20 
            alt="Past Headlines" 
            src="Overview of Pentium Probe Mode-Dateien/pastnews.gif" width=120 
            border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Overview of Pentium Probe Mode-Dateien/dot.gif" width=7 
            VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/articles/articles.htm"><IMG 
            height=40 alt="Microprocessor Articles" 
            src="Overview of Pentium Probe Mode-Dateien/m_articles.gif" 
            width=120 border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Overview of Pentium Probe Mode-Dateien/dot.gif" width=7 
            VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/secrets/intelsecrets.htm"><IMG 
            height=20 alt="Intel Secrets" 
            src="Overview of Pentium Probe Mode-Dateien/intel.gif" width=120 
            border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Overview of Pentium Probe Mode-Dateien/dot.gif" width=7 
            VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/errata/errataseries.htm"><IMG 
            height=20 alt="Intel Errata" 
            src="Overview of Pentium Probe Mode-Dateien/errata.gif" width=120 
            border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Overview of Pentium Probe Mode-Dateien/dot.gif" width=7 
            VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/ddj/ddj.htm"><IMG height=40 
            alt="Undocumented Corner" 
            src="Overview of Pentium Probe Mode-Dateien/udoc.gif" width=120 
            border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Overview of Pentium Probe Mode-Dateien/dot.gif" width=7 
            VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/intel.doc/inteldocs.htm"><IMG 
            height=40 alt="Processor Manuals" 
            src="Overview of Pentium Probe Mode-Dateien/pmanual.gif" width=120 
            border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Overview of Pentium Probe Mode-Dateien/dot.gif" width=7 
            VALIGN="top"></TD>
          <TD><A 
            href="http://x86.ddj.com/intel.doc/intelmotherboards.htm"><IMG 
            height=40 alt="Motherboard Manuals" 
            src="Overview of Pentium Probe Mode-Dateien/mmanual.gif" width=120 
            border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD vAlign=top><IMG height=20 alt="* " 
            src="Overview of Pentium Probe Mode-Dateien/dot.gif" width=7 
            VALIGN="top"></TD>
          <TD><A href="http://x86.ddj.com/links.htm"><IMG height=20 alt=Links 
            src="Overview of Pentium Probe Mode-Dateien/links.gif" width=120 
            border=0></A><BR clear=all></TD></TR>
        <TR>
          <TD><IMG height=50 alt="" 
            src="Overview of Pentium Probe Mode-Dateien/spacer.gif" width=1 
            align=top><BR clear=all></TD></TR>
        <TR>
          <TD align=left colSpan=2><!-- REMOTE AD CALL <%/remoteviewad?site=x86&pagepos=buttonsponsor|site=x86|pagepos=buttonsponsor%> --><A 
            href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=6783&amp;RunID=38371&amp;AdID=25450&amp;GroupID=304&amp;FamilyID=2749&amp;TagValues=2901.2949&amp;Redirect=http://www.sdmagazine.com" 
            target=_top><IMG height=1 alt="" 
            src="Overview of Pentium Probe Mode-Dateien/clear_1x1.gif" width=1 
            border=0></A> <!-- REMOTE AD CALL <%/remoteviewad?site=ddj&pagepos=buttonsponsor&uri=nav-bottom|uri=nav-bottom|site=ddj|pagepos=buttonsponsor%> --><!-- AD ERROR: No profiles found to match request (site=ddj, pagepos=buttonsponsor, server_name=, uri=)--></TD></TR></TBODY></TABLE></FONT></TD><!-- End left-hand column --><!--------------- MAIN BODY ------------>
    <TD vAlign=top>
      <TABLE cellSpacing=0 cellPadding=0 border=0>
        <TBODY>
        <TR>
          <TD><!-- First row: ad --><!-- REMOTE AD CALL <%/remoteviewad?site=x86&pagepos=top|site=x86|pagepos=top%> --><A 
            href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=7160&amp;RunID=37684&amp;AdID=28558&amp;GroupID=320&amp;FamilyID=1&amp;TagValues=178.2949&amp;Redirect=http://www.rsaconference.com" 
            target=_top><IMG height=60 alt="" 
            src="Overview of Pentium Probe Mode-Dateien/ddj_rsa_2002.gif" 
            width=468 border=1></A> </TD></TR>
        <TR>
          <TD background="Overview of Pentium Probe Mode-Dateien/dash_wide.gif"><!-- 2nd row: rule --><IMG 
            height=10 src="Overview of Pentium Probe Mode-Dateien/spacer.gif" 
            width=1> </TD></TR>
        <TR>
          <TD><!-- 3rd row: Header --><IMG height=40 
            alt="Microprocessor Resources" 
            src="Overview of Pentium Probe Mode-Dateien/microprocessor.gif" 
            width=350><BR clear=all><IMG height=10 
            src="D:\Eigene Dateien\OS Programming\Overview of Pentium Probe Mode-Dateien\spacer(1).gif" 
            width=1><BR></TD></TR>
        <TR>
          <TD><!-- 4th row: Page content -->
            <H1 align=center><FONT color=#0000ff>Overview of Pentium Probe 
            Mode<BR>by<BR>Robert R. Collins</FONT></H1>
            <HR>

            <P>The Pentium is equipped with a debugging mode, known as Probe 
            Mode. Probe mode is used for diagnostic purposes for newly designed 
            motherboards, and In-Circuit Emulator (ICE) support. Probe mode is 
            <B>not</B> an user-accessible operating mode which can be enabled or 
            disabled through software control. Probe mode is only accessible 
            through a combination of Boundary Scan registers and dedicated pins. 
            The probe mode registers lie in the boundary scan register space of 
            the Test Access Port (TAP), and are accessible only through the JTAG 
            support pins[<A 
            href="http://x86.ddj.com/articles/probemd/probemode.htm#ref1">1</A>].</P>
            <P>While in probe mode, the Pentium may examine and modify the 
            internal and external state of a system. Memory and I/O space may be 
            examined and modified. All internal CPU registers may also be 
            examined and modified -- including control registers (CRn), debug 
            registers (DRn), and MSR's.</P>
            <P>During probe mode, the normal execution of instructions is 
            interrupted, and the Pentium enters a <I>dormant</I> state. While 
            previous x86 processors with embedded ICE support were in ICE mode, 
            unbeknownst to the target system, they were still executing x86 ICE 
            program instructions. In these processors, ICE mode was an alternate 
            operating mode of the CPU, with its own dedicated program and memory 
            space (exactly like System Management Mode (SMM) is to the Pentium). 
            But unlike these previous x86 processors, Pentium probe mode is 
            truly a static state whereby prefetch and decode does not occur at 
            any level, for any purpose. Probe mode instructions to examine or 
            modify registers, memory, or I/O space are fed directly into the 
            Pentium's execution unit(s), thereby bypassing the prefetch and 
            decode stages altogether.</P>
            <H2>Probe Mode Implementation</H2>
            <P>Probe mode is implemented via extensions to the boundary scan 
            instruction set, two pins, and three (or possibly more) probe mode 
            registers. The boundary scan extensions which support probe mode 
            include instructions to <B><I>Begin Probe Mode</I></B>, <B><I>End 
            Probe Mode</I></B>, <B><I>Build Probe Instruction</I></B>, 
            <B><I>Execute Probe Instruction</I></B>, <B><I>Access Probe Data 
            Register</I></B>, and possibly (highly probable) instructions to 
            <B><I>Flush Data Cache</I></B>, <B><I>Flush Code Cache</I></B>, and 
            <B><I>Flush Both Caches</I></B>[<A 
            href="http://x86.ddj.com/articles/probemd/probemode.htm#ref4">4</A>][<A 
            href="http://x86.ddj.com/articles/probemd/probemode.htm#ref5">5</A>]. 
            The probe mode boundary scan instructions are marked as <I>Private 
            Instructions</I> in the Pentium boundary scan instruction set 
            summary[<A 
            href="http://x86.ddj.com/articles/probemd/probemode.htm#ref2">2</A>]. 
            The two pins defined to support probe mode are <B><I>R/S#</I></B>, 
            and <B><I>PRDY</I></B>. These pins are described (somewhat 
            incompletely) in the Pentium data sheet. The registers used to 
            support probe mode are the <B><I>Probe Instruction Register</I></B> 
            (PIR), <B><I>Probe Data Register</I></B> (PDR),<A 
            href="http://x86.ddj.com/articles/pmcr/probemodecontrolregister.htm" 
            name=PMCRPtr>Probe Mode Control Register</A> (PMCR), and possibly a 
            <B><I>Probe Status Register</I></B> (PSR)[<A 
            href="http://x86.ddj.com/articles/probemd/probemode.htm#ref3">3</A>].</P>
            <P>When in probe mode, the processor is in a dormant state. Prefetch 
            and decode do not occur. Any exceptions, NMI, or external interrupts 
            which are pending, or may become pending are not serviced until 
            termination of probe mode. Snoops, cache line fills, and writebacks 
            may occur during probe mode, since probe mode may perform 
            memory-based operations with the cache enabled[<A 
            href="http://x86.ddj.com/articles/probemd/probemode.htm#ref4">4</A>].</P>
            <H3>To Enter and Exit Probe Mode</H3>
            <P>Probe mode is entered by three possible methods. First the 
            processor may receive an <I>Begin Probe Mode</I> instruction from 
            the boundary scan instruction set. Upon such a receipt, the 
            processor immediately halts execution at the next instruction 
            boundary, and asserts <I>PRDY</I>. Once <I>PRDY</I> is asserted, the 
            processor is ready to receive probe mode instructions, via the 
            boundary scan mechanism. To exit probe mode, execute the boundary 
            scan instruction <I>Exit Probe Mode</I>, or external hardware must 
            force <I>R/S#</I> from high to low, then to high again. It is the 
            low-to-high transition which forces the Pentium to exit probe 
            mode[<A 
            href="http://x86.ddj.com/articles/probemd/probemode.htm#ref4">4</A>].</P>
            <P>Secondly, probe mode may be entered when external hardware 
            asserts <I>R/S#</I>. The processor will respond by asserting 
            <I>PRDY</I> when it is ready to accept probe mode instructions. To 
            exit probe mode, external hardware must force <I>R/S#</I> back high. 
            The boundary scan instruction, <I>End Probe Mode</I>, will not work 
            to exit probe mode for this entrance method. Since <I>R/S#</I> was 
            asserted to enter probe mode, forcing it high is not only 
            sufficient, but is the only means to exit[<A 
            href="http://x86.ddj.com/articles/probemd/probemode.htm#ref1">1</A>].</P>
            <P>Thirdly, the Pentium itself may enter probe mode whenever a debug 
            exception occurs. For this to occur, the Probe Mode Control Register 
            (PMCR) must be set to allow a debug exception to enter probe mode. 
            When the PMCR is set in such a manner, any debug exception which 
            occurs will cause the Pentium to enter probe mode. These conditions 
            are debug exceptions which occur because a debug register breakpoint 
            is detected, a single-step trap occurs, a task switch occurs into a 
            TSS whose T-bit is set, DR7.GD=1, and there was an attempt to access 
            one of the debug registers, or the debug exception instruction was 
            executed -- ICEBP. When PMCR[0]=1, the occurrence of any of these 
            conditions will cause the Pentium to enter probe mode. Once one of 
            these conditions occurs, the Pentium will immediately enter probe 
            mode, and assert <I>PRDY</I> and is ready to accept probe mode 
            instructions. To exit probe mode, execute the boundary scan 
            instruction <I>End Probe Mode</I>, or external hardware must force 
            <I>R/S#</I> from high to low, then to high again[<A 
            href="http://x86.ddj.com/articles/probemd/probemode.htm#ref4">4</A>].</P>
            <H3>Probe Mode Instructions</H3>
            <P>Probe instructions are <I>composed</I> in the Probe Instruction 
            Register. The PIR has full control over the both Pentium execution 
            units (<I>u-pipe</I>, and <I>v-pipe</I>), and the FPU core. The PIR 
            format is logically split between the <I>u-pipe</I> and 
            <I>v-pipe</I>, or the FPU pipe, and <I>v-pipe</I> Therefore two 
            micro-coded instructions may be submitted simultaneously using the 
            PIR. Composing probe mode instructions may require writing the PIR 
            multiple times. If such is the case, the PIR is updated after each 
            <I>Build Probe Instruction </I>boundary scan instruction is 
            executed. Once the micro-instruction for each pipe is completely 
            <I>composed</I>, issuance of <I>Execute Probe Instruction</I> will 
            cause execution of the probe mode instruction[<A 
            href="http://x86.ddj.com/articles/probemd/probemode.htm#ref5">5</A>].</P>
            <H2><A name=_Ref327625440></A>Conclusions</H2>
            <P>Pentium probe mode is highly dependent on the dual pipe 
            architecture of the Pentium. Probe mode provides a non-intrusive 
            method to read and write any aspect of the microprocessor state, 
            memory space, or I/O space. When in probe mode, the Pentium remains 
            in a dormant state, waiting to accept probe mode instructions, until 
            it is instructed to exit probe mode. Resumption from probe mode is 
            equally non-intrusive -- as no states of the processor have changed, 
            unless instructed to do so by probe mode instructions. Probe mode 
            instructions are composed and fed directly into the <I>u-pipe</I>, 
            <I>v-pipe</I>, and <I>FPU</I> of the Pentium. Instructions exist to 
            examine and modify <B>any</B> internal register, including MSR's. 
            There are no protection checks against probe mode instruction 
            operands, and the results of submitting errant operands is 
            indeterminate at this time. Probe mode provides an ideal means to 
            implement a hardware-based debugger, due to its non-intrusive 
            nature. </P>
            <HR>

            <H2>References</H2>
            <OL>
              <LI><A href="http://x86.ddj.com/intel.doc/586manuals.htm" 
              name=Ref2>Pentium Processor® Family Developer's Manual, Volume 
              1</A> (Chapter 31) 
              <LI><A href="http://x86.ddj.com/intel.doc/586manuals.htm" 
              name=Ref2>Pentium Processor® Family Developer's Manual, Volume 
              1</A> (Chapter 11) 
              <LI><A name=Ref3></A>Microtek In-Circuit Test Probe Manual, and 
              Help files. 
              <LI><A name=Ref4></A>Observed behavior using ICE, logic analyzer, 
              or both. 
              <LI><A name=Ref5></A>Pure Speculation. </LI></OL>
            <HR>

            <P><A 
            href="http://x86.ddj.com/articles/articles.htm#probemodeptr">Back to 
            Books and Articles home page</A></P></TD></TR>
        <TR>
          <TD background="Overview of Pentium Probe Mode-Dateien/dash_wide.gif"><!-- rule --><IMG 
            height=10 src="Overview of Pentium Probe Mode-Dateien/spacer.gif" 
            width=1> </TD></TR>
        <TR>
          <TD><!-- Bottom Advertisement -->
            <TABLE cellSpacing=0 cellPadding=1 width=490 bgColor=#cccccc 
            border=0>
              <TBODY>
              <TR>
                <TD vAlign=center align=middle><FONT face=Arial 
                  size=1>Advertisement</FONT> </TD></TR>
              <TR>
                <TD vAlign=center align=middle><!-- REMOTE AD CALL <%/remoteviewad?site=x86&pagepos=bottom|site=x86|pagepos=bottom%> --><A 
                  href="http://newads.cmpnet.com/event.ng/Type=click&amp;ProfileID=7167&amp;RunID=39005&amp;AdID=29421&amp;GroupID=320&amp;FamilyID=1&amp;TagValues=179.2949&amp;Redirect=http://www.microsoft.com/redirect.asp?PageID=157&amp;PARAM=TECWDOB&amp;TARGET=http://msdn.microsoft.com/events/teched/" 
                  target=_top><IMG height=60 alt="" 
                  src="Overview of Pentium Probe Mode-Dateien/micro_contest_2.gif" 
                  width=468 border=1></A> </TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD><!-- Copyright message --><FONT face="Arial, Helvetica" 
            size=-1>Copyright © 2002 <I>Dr. Dobb's 
        Journal<BR></I></FONT></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></BODY></HTML>
